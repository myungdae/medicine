<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NSCLC Agentic AI Platform â€” Evidence-Based Drug Development</title>
  <style>
    :root { 
      --bg:#0b1020; --card:#111a33; --line:#263158; --text:#e9ecff; --muted:#aab2d6; 
      --accent:#7aa2ff; --bad:#ff6b6b; --ok:#2ee59d; --warning:#ffb347; 
      --sidebar-w: 260px; --sidebar-collapsed: 60px;
    }
    * { box-sizing: border-box; }
    body { 
      margin:0; 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; 
      background: linear-gradient(180deg, #070a14, var(--bg)); 
      color: var(--text); 
      overflow-x: hidden;
    }

    /* Sidebar - Palantir Style */
    .sidebar {
      position: fixed;
      left: 0; top: 0; bottom: 0;
      width: var(--sidebar-w);
      background: rgba(7,10,20,0.95);
      border-right: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      display: flex;
      flex-direction: column;
      transition: width 0.3s ease;
      z-index: 100;
    }
    .sidebar.collapsed {
      width: var(--sidebar-collapsed);
    }
    .sidebar-header {
      padding: 20px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .sidebar-logo {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #7aa2ff, #2ee59d);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      flex-shrink: 0;
    }
    .sidebar-title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.3px;
      white-space: nowrap;
      overflow: hidden;
      opacity: 1;
      transition: opacity 0.2s;
    }
    .sidebar.collapsed .sidebar-title {
      opacity: 0;
      width: 0;
    }
    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
    }
    .nav-section {
      margin-bottom: 20px;
    }
    .nav-section-title {
      padding: 8px 16px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--muted);
      font-weight: 600;
      opacity: 1;
      transition: opacity 0.2s;
    }
    .sidebar.collapsed .nav-section-title {
      opacity: 0;
      height: 0;
      padding: 0;
      overflow: hidden;
    }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      margin: 2px 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: var(--muted);
      position: relative;
    }
    .nav-item:hover {
      background: rgba(122,162,255,0.08);
      color: var(--text);
    }
    .nav-item.active {
      background: rgba(122,162,255,0.15);
      color: var(--text);
      box-shadow: inset 0 0 0 1px rgba(122,162,255,0.3);
    }
    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 20px;
      background: var(--accent);
      border-radius: 0 2px 2px 0;
    }
    .nav-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    .nav-label {
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      opacity: 1;
      transition: opacity 0.2s;
    }
    .sidebar.collapsed .nav-label {
      opacity: 0;
      width: 0;
    }
    .nav-badge {
      margin-left: auto;
      background: rgba(255,179,71,0.2);
      color: var(--warning);
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
    }
    .sidebar-footer {
      padding: 12px 16px;
      border-top: 1px solid rgba(255,255,255,0.06);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .toggle-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(122,162,255,0.08);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      transition: all 0.2s;
    }
    .toggle-btn:hover {
      background: rgba(122,162,255,0.15);
    }

    /* Main Content */
    .main-wrapper {
      margin-left: var(--sidebar-w);
      transition: margin-left 0.3s ease;
      min-height: 100vh;
    }
    .sidebar.collapsed ~ .main-wrapper {
      margin-left: var(--sidebar-collapsed);
    }

    header { 
      padding: 22px 24px; 
      border-bottom: 1px solid rgba(255,255,255,0.06); 
      position: sticky; 
      top:0; 
      backdrop-filter: blur(8px); 
      background: rgba(7,10,20,0.85); 
      z-index: 50; 
    }
    header h1 { margin:0; font-size: 20px; letter-spacing: .3px; font-weight: 600; }
    header .sub { margin-top:6px; color: var(--muted); font-size: 13px; line-height: 1.4; }
    
    main { max-width: 1400px; margin: 0 auto; padding: 24px; }
    
    .page-content { display: none; }
    .page-content.active { display: block; }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: rgba(17,26,51,.92);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,.2);
    }
    .stat-label {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }
    .stat-change {
      font-size: 12px;
      color: var(--ok);
    }
    .stat-change.negative { color: var(--bad); }

    /* Two Column Layout for Hydrate */
    .two-col {
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
    }
    @media (max-width: 1100px){ .two-col { grid-template-columns: 1fr; } }

    .card { 
      background: rgba(17,26,51,.92); 
      border: 1px solid rgba(255,255,255,0.08); 
      border-radius: 14px; 
      padding: 20px; 
      box-shadow: 0 10px 30px rgba(0,0,0,.25); 
    }
    .card h2 { margin: 0 0 16px; font-size: 16px; font-weight: 600; }
    .card h3 { margin: 0 0 12px; font-size: 14px; font-weight: 600; color: var(--accent); }
    
    .grid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
    .grid3 { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; }
    
    label { display:block; font-size: 12px; color: var(--muted); margin: 0 0 6px; }
    input, select, textarea {
      width: 100%; padding: 10px 12px; border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.10); background: rgba(7,10,20,0.65);
      color: var(--text); outline: none; font-size: 13px;
    }
    textarea { min-height: 120px; resize: vertical; font-family: inherit; }
    input:focus, select:focus, textarea:focus { 
      border-color: rgba(122,162,255,0.55); 
      box-shadow: 0 0 0 3px rgba(122,162,255,0.12); 
    }
    
    .hint { font-size: 12px; color: var(--muted); margin-top: 6px; line-height: 1.4; }
    .pill { 
      display:inline-flex; align-items:center; gap:6px; font-size: 11px; 
      border: 1px solid rgba(255,255,255,0.10); padding: 4px 10px; 
      border-radius: 999px; color: var(--muted); 
    }
    .pill b { color: var(--text); font-weight: 600; }
    
    .tabs { display:flex; gap:8px; flex-wrap: wrap; margin-bottom: 12px; }
    .tab {
      cursor:pointer; user-select:none;
      padding: 8px 12px; border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.10);
      color: var(--muted); background: rgba(7,10,20,0.35);
      font-size: 12px; font-weight: 500;
      transition: all 0.2s;
    }
    .tab:hover { background: rgba(122,162,255,0.08); }
    .tab.active { 
      color: var(--text); 
      border-color: rgba(122,162,255,0.45); 
      background: rgba(122,162,255,0.12); 
    }
    
    .section { display:none; }
    .section.active { display:block; }
    
    .btns { display:flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end; margin-top: 16px; }
    button {
      cursor:pointer; border: 1px solid rgba(255,255,255,0.12);
      background: rgba(122,162,255,0.14); color: var(--text);
      padding: 10px 16px; border-radius: 8px; font-weight: 600;
      font-size: 13px; transition: all 0.2s;
    }
    button:hover { background: rgba(122,162,255,0.22); }
    button.secondary { background: rgba(7,10,20,0.55); color: var(--muted); }
    button.secondary:hover { background: rgba(7,10,20,0.75); }
    button.danger { background: rgba(255,107,107,0.12); border-color: rgba(255,107,107,0.25); }
    button.danger:hover { background: rgba(255,107,107,0.20); }
    
    .status { display:flex; align-items:center; gap:8px; margin-top: 12px; font-size: 12px; color: var(--muted); }
    .dot { 
      width:10px; height:10px; border-radius: 50%; 
      background: rgba(255,255,255,0.20); 
      border:1px solid rgba(255,255,255,0.10); 
    }
    .dot.ok { background: rgba(46,229,157,0.65); border-color: rgba(46,229,157,0.35); }
    .dot.bad { background: rgba(255,107,107,0.65); border-color: rgba(255,107,107,0.35); }
    
    pre {
      margin: 0; padding: 14px; border-radius: 10px; overflow:auto;
      background: rgba(7,10,20,0.65); border: 1px solid rgba(255,255,255,0.08);
      color: #dbe3ff; font-size: 12px; line-height: 1.5; max-height: 600px;
    }
    
    .req { color: var(--accent); margin-left: 4px; }
    .small { font-size: 11px; color: var(--muted); }

    /* Case List */
    .case-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .case-item {
      background: rgba(7,10,20,0.65);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .case-item:hover {
      border-color: rgba(122,162,255,0.35);
      background: rgba(122,162,255,0.05);
    }
    .case-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 8px;
    }
    .case-id {
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
    }
    .case-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
    }
    .case-badge.draft { background: rgba(170,178,214,0.15); color: var(--muted); }
    .case-badge.active { background: rgba(46,229,157,0.15); color: var(--ok); }
    .case-info {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    /* Timeline */
    .timeline {
      position: relative;
      padding-left: 30px;
    }
    .timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 8px;
      bottom: 8px;
      width: 2px;
      background: rgba(122,162,255,0.2);
    }
    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }
    .timeline-dot {
      position: absolute;
      left: -26px;
      top: 4px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent);
      border: 3px solid var(--bg);
    }
    .timeline-content {
      background: rgba(7,10,20,0.65);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px;
      padding: 12px;
    }
    .timeline-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .timeline-desc {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    .timeline-time {
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
    }

    /* Drug/Evidence Item Cards Enhancement */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }
    .info-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .info-label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .info-value {
      font-size: 13px;
      color: var(--text);
      font-weight: 500;
    }

    /* Chart Container */
    .chart-container {
      position: relative;
      height: 200px;
      background: rgba(7,10,20,0.65);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 16px;
      margin-top: 16px;
    }
    .chart-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 12px;
    }
    .chart-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .chart-label {
      min-width: 80px;
      font-size: 12px;
      color: var(--muted);
    }
    .chart-bar-fill {
      flex: 1;
      height: 24px;
      background: linear-gradient(90deg, rgba(122,162,255,0.3), rgba(46,229,157,0.3));
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }
    .chart-bar-value {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      font-weight: 600;
      color: var(--text);
    }

    /* Loading Skeleton */
    .skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s ease-in-out infinite;
      border-radius: 8px;
    }
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.2s ease-out;
    }
    .modal-overlay.active {
      display: flex;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      animation: slideUp 0.3s ease-out;
      position: relative;
    }
    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(30px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    .modal-header {
      padding: 24px 28px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: var(--card);
      z-index: 10;
      border-radius: 16px 16px 0 0;
    }
    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin: 0;
    }
    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,107,107,0.1);
      color: var(--bad);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all 0.2s;
    }
    .modal-close:hover {
      background: rgba(255,107,107,0.2);
      transform: rotate(90deg);
    }
    .modal-body {
      padding: 24px 28px;
    }
    .modal-section {
      margin-bottom: 20px;
    }
    .modal-section:last-child {
      margin-bottom: 0;
    }
    .modal-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .modal-text {
      color: var(--text);
      line-height: 1.6;
      font-size: 14px;
    }
    .modal-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }
    .modal-meta-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .modal-meta-label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .modal-meta-value {
      font-size: 14px;
      color: var(--text);
      font-weight: 500;
    }
    .modal-list {
      list-style: none;
      padding: 0;
      margin: 8px 0 0 0;
    }
    .modal-list li {
      padding: 8px 12px;
      background: rgba(7,10,20,0.65);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 13px;
      line-height: 1.5;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: var(--sidebar-collapsed);
      }
      .sidebar-title, .nav-label, .nav-section-title {
        opacity: 0;
        width: 0;
      }
      .main-wrapper {
        margin-left: var(--sidebar-collapsed);
      }
      .grid, .grid3 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">ğŸ§¬</div>
      <div class="sidebar-title">NSCLC AI</div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Core Modules</div>
        <a class="nav-item active" data-page="dashboard">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">Dashboard</span>
        </a>
        <a class="nav-item" data-page="hydrate">
          <span class="nav-icon">ğŸ’§</span>
          <span class="nav-label">Hydrate Ontology</span>
          <span class="nav-badge">Data</span>
        </a>
        <a class="nav-item" data-page="cases">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-label">Patient Cases</span>
        </a>
        <a class="nav-item" data-page="reasoning">
          <span class="nav-icon">ğŸ§ </span>
          <span class="nav-label">Reasoning Engine</span>
          <span class="nav-badge">AI</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Knowledge Base</div>
        <a class="nav-item" data-page="evidence">
          <span class="nav-icon">ğŸ“š</span>
          <span class="nav-label">Evidence Library</span>
        </a>
        <a class="nav-item" data-page="ontology">
          <span class="nav-icon">ğŸ”¬</span>
          <span class="nav-label">Ontology Browser</span>
        </a>
        <a class="nav-item" data-page="validation">
          <span class="nav-icon">âœ“</span>
          <span class="nav-label">SHACL Validation</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Analysis</div>
        <a class="nav-item" data-page="recommendations">
          <span class="nav-icon">ğŸ’Š</span>
          <span class="nav-label">Drug Recommendations</span>
        </a>
        <a class="nav-item" data-page="pipeline">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-label">Pipeline Monitor</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Drug Discovery</div>
        <a class="nav-item" data-page="discovery">
          <span class="nav-icon">ğŸ”¬</span>
          <span class="nav-label">Discovery Insights</span>
          <span class="nav-badge" style="background: rgba(255,107,107,0.2); color: var(--bad);">HOT</span>
        </a>
        <a class="nav-item" data-page="herbal">
          <span class="nav-icon">ğŸŒ¿</span>
          <span class="nav-label">Herbal Compounds</span>
          <span class="nav-badge" style="background: rgba(46,229,157,0.2); color: var(--ok);">NEW</span>
        </a>
        <a class="nav-item" data-page="unmet">
          <span class="nav-icon">ğŸ¯</span>
          <span class="nav-label">Unmet Needs</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Resources</div>
        <a class="nav-item" href="download-ontology.html">
          <span class="nav-icon">ğŸ“¥</span>
          <span class="nav-label">Download Ontology</span>
        </a>
      </div>
    </nav>

    <div class="sidebar-footer">
      <button class="toggle-btn" id="toggleSidebar" title="Toggle sidebar">
        â˜°
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-wrapper">
    <!-- Dashboard Page -->
    <div class="page-content active" id="page-dashboard">
      <header>
        <h1>Dashboard â€” NSCLC Agentic AI Platform</h1>
        <div class="sub">
          Evidence-based drug development system for NSCLC with EGFR/ALK alterations
          <span class="pill" style="margin-left:8px;">Status: <b>Development</b></span>
        </div>
      </header>

      <main>
        <div class="dashboard-grid" id="dashboardStats">
          <div class="stat-card">
            <div class="stat-label">Evidence Items</div>
            <div class="stat-value" id="stat-evidence">-</div>
            <div class="stat-change" id="stat-evidence-change">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Patient Cases</div>
            <div class="stat-value" id="stat-cases">-</div>
            <div class="stat-change" id="stat-cases-change">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Active Drugs</div>
            <div class="stat-value" id="stat-drugs">-</div>
            <div class="stat-change" id="stat-drugs-change">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Validation Rate</div>
            <div class="stat-value" id="stat-validation">-</div>
            <div class="stat-change" id="stat-validation-change">Loading...</div>
          </div>
        </div>

        <!-- Charts Section Row 1 -->
        <div class="two-col" style="margin-bottom: 24px;">
          <div class="card">
            <h2>Evidence by Type</h2>
            <div class="chart-container" id="chartEvidenceType">
              <div class="skeleton" style="width: 100%; height: 100%;"></div>
            </div>
          </div>
          <div class="card">
            <h2>Confidence Distribution</h2>
            <div class="chart-container" id="chartConfidence">
              <div class="skeleton" style="width: 100%; height: 100%;"></div>
            </div>
          </div>
        </div>

        <!-- Charts Section Row 2 -->
        <div class="dashboard-grid" style="margin-bottom: 24px;">
          <div class="card">
            <h2>Gene Distribution</h2>
            <div class="chart-container" id="chartGene" style="height: 180px;">
              <div class="skeleton" style="width: 100%; height: 100%;"></div>
            </div>
          </div>
          <div class="card">
            <h2>Line of Therapy</h2>
            <div class="chart-container" id="chartLineTherapy" style="height: 180px;">
              <div class="skeleton" style="width: 100%; height: 100%;"></div>
            </div>
          </div>
          <div class="card">
            <h2>Trial Phase Distribution</h2>
            <div class="chart-container" id="chartTrialPhase" style="height: 180px;">
              <div class="skeleton" style="width: 100%; height: 100%;"></div>
            </div>
          </div>
        </div>

        <div class="two-col">
          <div class="card">
            <h2>Recent Activity</h2>
            <div class="timeline" id="recentTimeline">
              <div class="skeleton" style="height: 200px; margin: 12px 0;"></div>
            </div>
          </div>

          <div class="card">
            <h2>System Status</h2>
            <div style="margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px; color: var(--muted);">Data Pipeline</span>
                <span style="font-size: 12px; color: var(--ok);">â—  Operational</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px; color: var(--muted);">Reasoning Engine</span>
                <span style="font-size: 12px; color: var(--ok);">â—  Ready</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px; color: var(--muted);">SHACL Validator</span>
                <span style="font-size: 12px; color: var(--ok);">â—  Active</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="font-size: 12px; color: var(--muted);">RAG System</span>
                <span style="font-size: 12px; color: var(--warning);">â—  Indexing</span>
              </div>
            </div>

            <h3 style="margin-top: 24px;">Quick Actions</h3>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <button onclick="navigateTo('hydrate')" style="width: 100%; justify-content: center;">
                ğŸ’§ Add New Evidence
              </button>
              <button onclick="navigateTo('cases')" style="width: 100%; justify-content: center;" class="secondary">
                ğŸ“‹ Create Patient Case
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Hydrate Ontology Page -->
    <div class="page-content" id="page-hydrate">
      <header>
        <h1>Hydrate Ontology â€” Article Ingestion</h1>
        <div class="sub">
          ì´ í™”ë©´ì˜ ëª©ì ì€ <b>íŒë‹¨(ì¶”ì²œ)</b>ì´ ì•„ë‹ˆë¼ <b>ì¦ê±°(Article)ì™€ ê´€ì¸¡ê°’(Observation/Result)ì˜ ë§¥ë½ ë³´ì¡´</b>ì…ë‹ˆë‹¤.
          <span class="pill" style="margin-left:8px;">MoE Expert: <b>Human Curator</b></span>
        </div>
      </header>

      <main>
        <div class="two-col">
          <!-- LEFT: FORM -->
          <section class="card">
            <h2>Article ì…ë ¥ (Hydrate)</h2>

            <div class="tabs" id="tabs">
              <div class="tab active" data-tab="meta">ë©”íƒ€ë°ì´í„°</div>
              <div class="tab" data-tab="content">ì›ë¬¸/ìš”ì•½ ì…ë ¥</div>
              <div class="tab" data-tab="entities">ì—”í‹°í‹°/ì½”í˜¸íŠ¸</div>
              <div class="tab" data-tab="results">ê²°ê³¼ ìˆ˜ì¹˜</div>
              <div class="tab" data-tab="governance">ì‹ ë¢°ë„/ê±°ë²„ë„ŒìŠ¤</div>
            </div>

            <!-- META -->
            <div class="section active" id="sec-meta">
              <div class="grid">
                <div>
                  <label>Evidence Type<span class="req">*</span></label>
                  <select id="evidenceType">
                    <option value="Paper">Paper (ë…¼ë¬¸)</option>
                    <option value="TrialSummary">TrialSummary (ì„ìƒ ìš”ì•½)</option>
                    <option value="Review">Review (ë¦¬ë·°)</option>
                    <option value="Preprint">Preprint (í”„ë¦¬í”„ë¦°íŠ¸)</option>
                  </select>
                </div>
                <div>
                  <label>Publication Date<span class="req">*</span></label>
                  <input id="pubDate" type="date" />
                </div>

                <div style="grid-column: 1 / -1;">
                  <label>Title<span class="req">*</span></label>
                  <input id="title" placeholder="ì˜ˆ: First-line EGFR TKI in NSCLC with exon19del..." />
                </div>

                <div>
                  <label>DOI (ì„ íƒ)</label>
                  <input id="doi" placeholder="10.xxxx/xxxxx" />
                </div>
                <div>
                  <label>Source URL (ì„ íƒ)</label>
                  <input id="sourceUrl" placeholder="https://..." />
                </div>

                <div style="grid-column: 1 / -1;">
                  <label>Authors / Organization (ì„ íƒ)</label>
                  <input id="authors" placeholder="ì˜ˆ: Kim J; Lee S; ... ë˜ëŠ” Sponsor/Company" />
                </div>

                <div>
                  <label>Journal / Venue (ì„ íƒ)</label>
                  <input id="venue" placeholder="ì˜ˆ: NEJM / ASCO / arXiv ..." />
                </div>
                <div>
                  <label>Trial ID (NCT ë“±, ì„ìƒ ìš”ì•½ì¼ ë•Œ ê¶Œì¥)</label>
                  <input id="trialId" placeholder="ì˜ˆ: NCT01234567" />
                </div>
              </div>

              <div class="hint">
                âœ… Hydrate ì›ì¹™: "ê²°ë¡ "ì„ ë„£ì§€ ë§ê³ , ì¶œì²˜/ë‚ ì§œ/ë§¥ë½ì„ ë¨¼ì € í™•ë³´í•˜ì„¸ìš”.
              </div>
            </div>

            <!-- CONTENT -->
            <div class="section" id="sec-content">
              <div class="grid">
                <div style="grid-column: 1 / -1;">
                  <label>Abstract / Trial Summary Text<span class="req">*</span></label>
                  <textarea id="abstractText" placeholder="ë…¼ë¬¸ ì´ˆë¡ ë˜ëŠ” ì„ìƒ ìš”ì•½ í…ìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°"></textarea>
                  <div class="hint">ë¶™ì—¬ë„£ì€ í…ìŠ¤íŠ¸ëŠ” EvidenceItemì˜ ì›ë¬¸(ê·¼ê±°)ë¡œ ì €ì¥ë©ë‹ˆë‹¤. (RAG ì¶”ì¶œ í›„ë³´ ìƒì„±ì—ë„ ì‚¬ìš©)</div>
                </div>

                <div style="grid-column: 1 / -1;">
                  <label>Methods / Notes (ì„ íƒ)</label>
                  <textarea id="methodsText" placeholder="ëª¨ë¸/í™˜ìêµ°/endpoint ì •ì˜ ë“± ì¤‘ìš”í•œ ë§¥ë½ ë©”ëª¨"></textarea>
                </div>
              </div>
            </div>

            <!-- ENTITIES -->
            <div class="section" id="sec-entities">
              <div class="grid3">
                <div>
                  <label>Cancer Type<span class="req">*</span></label>
                  <select id="cancerType">
                    <option value="NSCLC">NSCLC</option>
                  </select>
                </div>
                <div>
                  <label>Gene Focus<span class="req">*</span></label>
                  <select id="geneFocus">
                    <option value="EGFR">EGFR</option>
                    <option value="ALK">ALK</option>
                  </select>
                </div>
                <div>
                  <label>Alteration<span class="req">*</span></label>
                  <select id="alteration">
                    <option value="EGFR_ex19del">EGFR exon19 del</option>
                    <option value="EGFR_L858R">EGFR L858R</option>
                    <option value="ALK_fusion">ALK fusion</option>
                  </select>
                </div>
              </div>

              <div class="grid">
                <div>
                  <label>Patient Subgroup Label (ìë™ ìƒì„±)</label>
                  <input id="subgroupLabel" readonly />
                  <div class="small">ì˜ˆ: NSCLC + EGFR exon19 del</div>
                </div>
                <div>
                  <label>Line of Therapy (ì„ íƒ)</label>
                  <select id="lot">
                    <option value="">(ë¯¸ìƒ)</option>
                    <option value="1L">1L</option>
                    <option value="2L">2L</option>
                    <option value="3L+">3L+</option>
                  </select>
                </div>

                <div style="grid-column: 1 / -1;">
                  <label>Drug / Compound Name<span class="req">*</span></label>
                  <input id="drugName" placeholder="ì˜ˆ: Drug_A (EGFR inhibitor)" />
                </div>

                <div>
                  <label>MoA (ì„ íƒ)</label>
                  <select id="moa">
                    <option value="">(ë¯¸ìƒ)</option>
                    <option value="TKI">TKI</option>
                    <option value="mAb">mAb (í•­ì²´)</option>
                    <option value="ADC">ADC</option>
                  </select>
                </div>
                <div>
                  <label>Targets (ìë™: Gene Focus)</label>
                  <input id="targets" readonly />
                </div>
              </div>

              <div class="hint">
                ğŸ” ë™ì˜ì–´ ì •ê·œí™”ëŠ” ì—¬ê¸°ì„œ ì‹œì‘í•©ë‹ˆë‹¤. EGFR/ALK, ë³€ì´ í‘œê¸°(ex19del vs del19)ë¥¼ "í•œ ì¸ìŠ¤í„´ìŠ¤"ë¡œ ê³ ì •í•˜ëŠ” ê²Œ hydrateì˜ í•µì‹¬ì…ë‹ˆë‹¤.
              </div>
            </div>

            <!-- RESULTS -->
            <div class="section" id="sec-results">
              <div class="grid">
                <div>
                  <label>Metric<span class="req">*</span></label>
                  <select id="metric">
                    <option value="ORR">ORR</option>
                    <option value="PFS">PFS</option>
                    <option value="OS">OS</option>
                    <option value="IC50">IC50</option>
                  </select>
                </div>
                <div>
                  <label>Value<span class="req">*</span></label>
                  <input id="value" type="number" step="0.01" placeholder="ì˜ˆ: 62.0" />
                </div>
                <div>
                  <label>Unit<span class="req">*</span></label>
                  <select id="unit">
                    <option value="%">%</option>
                    <option value="months">months</option>
                    <option value="nM">nM</option>
                    <option value="uM">uM</option>
                  </select>
                </div>

                <div style="grid-column: 1 / -1;">
                  <label>Result Notes (ì„ íƒ)</label>
                  <input id="resultNotes" placeholder="ì˜ˆ: median follow-up, cutoff date, cohort details..." />
                </div>
              </div>

              <div class="hint">
                âœ… SHACL ê²Œì´íŠ¸ ê´€ì : metric/value/unit + reportedIn(EvidenceItem)ì´ ì—†ìœ¼ë©´ ResultëŠ” "ë³´ë¥˜/ë°˜ë ¤" ì²˜ë¦¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
              </div>
            </div>

            <!-- GOVERNANCE -->
            <div class="section" id="sec-governance">
              <div class="grid">
                <div>
                  <label>Peer Reviewed?</label>
                  <select id="peerReviewed">
                    <option value="unknown">unknown</option>
                    <option value="true">true</option>
                    <option value="false">false</option>
                  </select>
                </div>
                <div>
                  <label>Confidence Level</label>
                  <select id="confidence">
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                    <option value="Low">Low</option>
                  </select>
                </div>

                <div style="grid-column: 1 / -1;">
                  <label>Limitations / Caveats (ì„ íƒ)</label>
                  <textarea id="limitations" placeholder="ì˜ˆ: small N, single-arm, selection bias, immature OS data..."></textarea>
                </div>

                <div>
                  <label>Funding / Sponsor (ì„ íƒ)</label>
                  <input id="funding" placeholder="ì˜ˆ: Pharma / Public / Unknown" />
                </div>
                <div>
                  <label>Conflict of Interest (ì„ íƒ)</label>
                  <select id="coi">
                    <option value="unknown">unknown</option>
                    <option value="true">true</option>
                    <option value="false">false</option>
                  </select>
                </div>
              </div>

              <div class="hint">
                ğŸ§  ì—¬ê¸°ê¹Œì§€ ì €ì¥ë˜ë©´, Activate ë‹¨ê³„ì—ì„œ SWRL/ìŠ¤ì½”ì–´ë§ì´ "ê·¼ê±°ì˜ ì§ˆ"ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </div>
            </div>

            <div class="btns">
              <button class="secondary" id="btnExample">ì˜ˆì‹œ ì±„ìš°ê¸°</button>
              <button class="danger" id="btnClear">ì´ˆê¸°í™”</button>
              <button id="btnBuild">Hydrate JSON ìƒì„±</button>
            </div>

            <div class="status" id="status">
              <span class="dot" id="dot"></span>
              <span id="statusText">í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ë©´ JSONì´ ìƒì„±ë©ë‹ˆë‹¤.</span>
            </div>
          </section>

          <!-- RIGHT: PREVIEW -->
          <aside class="card">
            <h2>Hydrate Payload ë¯¸ë¦¬ë³´ê¸°</h2>
            <div class="hint" style="margin-bottom:12px;">
              ì´ JSONì€ ì„œë²„ë¡œ ë³´ë‚´ì„œ<br/>
              (a) EvidenceItem ì €ì¥ â†’ (b) Result ì €ì¥ â†’ (c) SHACL ê²€ì¦ â†’ (d) Activate ë‹¨ê³„ë¡œ ë„˜ê¹€<br/>
              ê°™ì€ íŒŒì´í”„ë¼ì¸ì— ë°”ë¡œ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            <pre id="preview">{}</pre>
          </aside>
        </div>
      </main>
    </div>

    <!-- Patient Cases Page -->
    <div class="page-content" id="page-cases">
      <header>
        <h1>Patient Cases â€” Clinical Decision Support</h1>
        <div class="sub">
          í™˜ì ì‚¬ë¡€ ê´€ë¦¬ ë° ì¹˜ë£Œ ì¶”ì²œ ì‹œìŠ¤í…œ
        </div>
      </header>

      <main>
        <div class="card">
          <h2>Active Patient Cases</h2>
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <input type="text" id="caseSearch" placeholder="ğŸ” Search by case ID or profile..." style="flex: 1; min-width: 280px;" />
            <select id="caseFilterStatus" style="width: auto;">
              <option value="">All Status</option>
              <option value="Active">Active</option>
              <option value="Draft">Draft</option>
              <option value="Rejected">Rejected</option>
              <option value="Executed">Executed</option>
            </select>
          </div>
          <div id="caseList" class="case-list">
            <p style="color: var(--muted); text-align: center; padding: 24px;">Loading patient cases...</p>
          </div>

          <div class="btns">
            <button onclick="navigateTo('hydrate')">+ Create New Case</button>
            <button class="secondary">Export Report</button>
          </div>
        </div>
      </main>
    </div>

    <!-- Other Pages (Placeholders) -->
    <div class="page-content" id="page-reasoning">
      <header>
        <h1>Reasoning Engine â€” AI-Powered Analysis</h1>
        <div class="sub">SWRL ê¸°ë°˜ ì¶”ë¡  ë° ì¹˜ë£Œ ì¶”ì²œ ìƒì„± ì—”ì§„</div>
      </header>
      <main>
        <div class="card">
          <h2>Reasoning Engine</h2>
          <p style="color: var(--muted); line-height: 1.6;">
            SWRL (Semantic Web Rule Language) ê¸°ë°˜ì˜ ì¶”ë¡  ì—”ì§„ì…ë‹ˆë‹¤.<br/>
            ì˜¨í†¨ë¡œì§€ì— ì €ì¥ëœ ì¦ê±°(Evidence)ì™€ í™˜ì í”„ë¡œí•„ì„ ê¸°ë°˜ìœ¼ë¡œ<br/>
            ìµœì ì˜ ì¹˜ë£Œ ì˜µì…˜ì„ ì¶”ì²œí•©ë‹ˆë‹¤.
          </p>
          <div class="hint" style="margin-top: 16px;">
            ğŸš§ Coming soon: Rule editor, inference logs, confidence scoring
          </div>
        </div>
      </main>
    </div>

    <div class="page-content" id="page-evidence">
      <header>
        <h1>Evidence Library â€” Knowledge Repository</h1>
        <div class="sub">ìˆ˜ì§‘ëœ ëª¨ë“  ì¦ê±° ì•„ì´í…œ ê²€ìƒ‰ ë° ê´€ë¦¬</div>
      </header>
      <main>
        <div class="card">
          <h2>Evidence Library</h2>
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <input type="text" id="evidenceSearch" placeholder="ğŸ” Search by title, drug, or trial ID..." style="flex: 1; min-width: 280px;" />
            <select id="evidenceFilterType" style="width: auto;">
              <option value="">All Types</option>
              <option value="Paper">Paper</option>
              <option value="TrialSummary">Trial Summary</option>
              <option value="Review">Review</option>
            </select>
            <select id="evidenceFilterConfidence" style="width: auto;">
              <option value="">All Confidence</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>
          <div id="evidenceList" class="case-list">
            <p style="color: var(--muted); text-align: center; padding: 24px;">Loading evidence items...</p>
          </div>
        </div>
      </main>
    </div>

    <div class="page-content" id="page-ontology">
      <header>
        <h1>Ontology Browser â€” RDF/OWL Explorer</h1>
        <div class="sub">ì˜¨í†¨ë¡œì§€ êµ¬ì¡° íƒìƒ‰ ë° ê´€ê³„ ì‹œê°í™”</div>
      </header>
      <main>
        <div class="card">
          <h2>Ontology Browser</h2>
          <p style="color: var(--muted); line-height: 1.6;">
            RDF/OWL ê¸°ë°˜ ì˜¨í†¨ë¡œì§€ì˜ êµ¬ì¡°ë¥¼ ì‹œê°í™”í•˜ê³  íƒìƒ‰í•©ë‹ˆë‹¤.<br/>
            ìœ ì „ì, ë³€ì´, ì•½ë¬¼, ê²°ê³¼ ê°„ì˜ ê´€ê³„ë¥¼ ê·¸ë˜í”„ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.
          </p>
          <div class="hint" style="margin-top: 16px;">
            ğŸš§ Coming soon: Graph visualization, SPARQL query interface
          </div>
        </div>
      </main>
    </div>

    <div class="page-content" id="page-validation">
      <header>
        <h1>SHACL Validation â€” Data Quality Gate</h1>
        <div class="sub">ë°ì´í„° í’ˆì§ˆ ê²€ì¦ ë° ì œì•½ ì¡°ê±´ ê´€ë¦¬</div>
      </header>
      <main>
        <div class="card">
          <h2>SHACL Validation</h2>
          <p style="color: var(--muted); line-height: 1.6;">
            SHACL (Shapes Constraint Language)ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° í’ˆì§ˆì„ ê²€ì¦í•©ë‹ˆë‹¤.<br/>
            í•„ìˆ˜ í•„ë“œ, ë°ì´í„° íƒ€ì…, ê´€ê³„ ë¬´ê²°ì„± ë“±ì„ ìë™ìœ¼ë¡œ ì²´í¬í•©ë‹ˆë‹¤.
          </p>
          <div class="hint" style="margin-top: 16px;">
            ğŸš§ Coming soon: Validation rules editor, error reports, auto-fix suggestions
          </div>
        </div>
      </main>
    </div>

    <div class="page-content" id="page-recommendations">
      <header>
        <h1>Drug Recommendations â€” Treatment Options</h1>
        <div class="sub">í™˜ìë³„ ë§ì¶¤ ì¹˜ë£Œ ì˜µì…˜ ë° ê·¼ê±° ì œì‹œ</div>
      </header>
      <main>
        <div class="card">
          <h2>Drug Recommendations â€” Top Candidates</h2>
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <select id="drugFilterGene" style="width: auto;">
              <option value="">All Genes</option>
              <option value="EGFR">EGFR</option>
              <option value="ALK">ALK</option>
            </select>
            <select id="drugFilterApproval" style="width: auto;">
              <option value="">All Status</option>
              <option value="FDA">FDA Approved</option>
              <option value="EMA">EMA Approved</option>
              <option value="Both">FDA & EMA</option>
            </select>
            <button id="sortByConfidence" class="secondary" style="margin-left: auto;">Sort by Confidence â†“</button>
          </div>
          <div id="drugList" class="case-list">
            <p style="color: var(--muted); text-align: center; padding: 24px;">Loading drug recommendations...</p>
          </div>
        </div>
      </main>
    </div>

    <div class="page-content" id="page-pipeline">
      <header>
        <h1>Pipeline Monitor â€” System Operations</h1>
        <div class="sub">ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</div>
      </header>
      <main>
        <div class="card">
          <h2>Pipeline Monitor</h2>
          <p style="color: var(--muted); line-height: 1.6;">
            Hydrate â†’ SHACL Validation â†’ Activate â†’ Recommend íŒŒì´í”„ë¼ì¸ì˜<br/>
            ê° ë‹¨ê³„ë³„ ì²˜ë¦¬ í˜„í™©ê³¼ ì„±ëŠ¥ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
          </p>
          <div class="hint" style="margin-top: 16px;">
            ğŸš§ Coming soon: Real-time logs, performance metrics, error tracking
          </div>
        </div>
      </main>
    </div>

    <!-- Drug Discovery Insights Page -->
    <div class="page-content" id="page-discovery">
      <header>
        <h1>ğŸ”¬ Drug Discovery Insights â€” Finding Innovation Opportunities</h1>
        <div class="sub">
          ì‹ ì•½ê°œë°œ ê¸°íšŒ ë°œê²¬: Unmet Needs, Drug Repurposing, Novel Combinations
          <span class="pill" style="margin-left:8px;">AI-Powered: <b>Discovery Engine</b></span>
        </div>
      </header>

      <main>
        <!-- Top Opportunities -->
        <div class="card" style="margin-bottom: 24px; border: 2px solid rgba(255,107,107,0.3);">
          <h2 style="color: var(--bad);">ğŸ”¥ Top Discovery Opportunities</h2>
          <div id="topOpportunities" class="case-list">
            <div class="skeleton" style="height: 200px;"></div>
          </div>
        </div>

        <!-- Candidate Discovery -->
        <div class="card" style="margin-bottom: 24px;">
          <h2>ğŸ’¡ Novel Drug Candidates</h2>
          <div class="sub" style="margin-bottom: 16px;">
            AI-identified combinations and formulations with high development potential
          </div>
          <div id="candidatesList" class="case-list">
            <div class="skeleton" style="height: 300px;"></div>
          </div>
        </div>

        <!-- Knowledge Gaps -->
        <div class="card">
          <h2>ğŸ“Š Knowledge Gap Analysis</h2>
          <div class="sub" style="margin-bottom: 16px;">
            Research areas with insufficient evidence (opportunities for publication/trials)
          </div>
          <div id="knowledgeGapsList" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px;">
            <div class="skeleton" style="height: 150px;"></div>
          </div>
        </div>
      </main>
    </div>

    <!-- Herbal Compounds Page -->
    <div class="page-content" id="page-herbal">
      <header>
        <h1>ğŸŒ¿ Herbal Compounds Database â€” Traditional + Modern Medicine</h1>
        <div class="sub">
          ì²œì—°ë¬¼/í•œì•½ ì„±ë¶„ ë°ì´í„°ë² ì´ìŠ¤: ì‹ ì•½ê°œë°œê³¼ ì „í†µì˜í•™ì˜ ìœµí•©
        </div>
      </header>

      <main>
        <div class="card">
          <h2>Natural Products & Traditional Medicine</h2>
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <input type="text" id="herbalSearch" placeholder="ğŸ” Search by name, source, or target..." style="flex: 1; min-width: 280px;" />
            <select id="herbalFilterStatus" style="width: auto;">
              <option value="">All Status</option>
              <option value="Phase III">Phase III</option>
              <option value="Phase II">Phase II</option>
              <option value="Phase I">Phase I</option>
              <option value="Preclinical">Preclinical</option>
            </select>
          </div>
          <div id="herbalList" class="case-list">
            <p style="color: var(--muted); text-align: center; padding: 24px;">Loading herbal compounds...</p>
          </div>
        </div>
      </main>
    </div>

    <!-- Unmet Needs Page -->
    <div class="page-content" id="page-unmet">
      <header>
        <h1>ğŸ¯ Unmet Medical Needs â€” Critical Treatment Gaps</h1>
        <div class="sub">
          ë¯¸ì¶©ì¡± ì˜í•™ ìˆ˜ìš”: ì•„ì§ í•´ê²°ë˜ì§€ ì•Šì€ ì¹˜ë£Œ ê³µë°± ë¶„ì„
        </div>
      </header>

      <main>
        <div class="card">
          <h2>Critical Unmet Needs in NSCLC</h2>
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <select id="unmetFilterPriority" style="width: auto;">
              <option value="">All Priority</option>
              <option value="Critical">Critical</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
            </select>
            <select id="unmetFilterCategory" style="width: auto;">
              <option value="">All Categories</option>
              <option value="Resistance Mechanism">Resistance</option>
              <option value="Biomarker Gap">Biomarker</option>
              <option value="Treatment Sequence">Treatment Sequence</option>
              <option value="Rare Mutation">Rare Mutation</option>
              <option value="Combination Therapy">Combination</option>
            </select>
          </div>
          <div id="unmetNeedsList" class="case-list">
            <p style="color: var(--muted); text-align: center; padding: 24px;">Loading unmet needs...</p>
          </div>
        </div>

        <!-- Drug Repurposing -->
        <div class="card" style="margin-top: 24px;">
          <h2>ğŸ”„ Drug Repurposing Opportunities</h2>
          <div class="sub" style="margin-bottom: 16px;">
            ê¸°ì¡´ ì•½ë¬¼ì˜ ìƒˆë¡œìš´ ìš©ë„ (Low-hanging fruits)
          </div>
          <div id="repurposingList" class="case-list">
            <div class="skeleton" style="height: 200px;"></div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Modal: Evidence Detail -->
  <div class="modal-overlay" id="modalEvidence">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalEvidenceTitle">Evidence Details</h3>
        <button class="modal-close" onclick="closeModal('modalEvidence')">Ã—</button>
      </div>
      <div class="modal-body" id="modalEvidenceBody">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>

  <!-- Modal: Case Detail -->
  <div class="modal-overlay" id="modalCase">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalCaseTitle">Case Details</h3>
        <button class="modal-close" onclick="closeModal('modalCase')">Ã—</button>
      </div>
      <div class="modal-body" id="modalCaseBody">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>

  <!-- Modal: Drug Detail -->
  <div class="modal-overlay" id="modalDrug">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalDrugTitle">Drug Details</h3>
        <button class="modal-close" onclick="closeModal('modalDrug')">Ã—</button>
      </div>
      <div class="modal-body" id="modalDrugBody">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // Mock Data State
    let evidenceData = [];
    let casesData = [];
    let drugsData = [];
    let resultsData = [];
    let herbalData = [];
    let discoveryInsights = {};

    // Load Mock Data
    async function loadMockData() {
      try {
        const [evidenceRes, casesRes, drugsRes, resultsRes, herbalRes, insightsRes] = await Promise.all([
          fetch('mockdata/evidence-items.json'),
          fetch('mockdata/patient-cases.json'),
          fetch('mockdata/drugs.json'),
          fetch('mockdata/results.json'),
          fetch('mockdata/herbal-compounds.json'),
          fetch('mockdata/drug-discovery-insights.json')
        ]);
        
        evidenceData = await evidenceRes.json();
        casesData = await casesRes.json();
        drugsData = await drugsRes.json();
        resultsData = await resultsRes.json();
        herbalData = await herbalRes.json();
        discoveryInsights = await insightsRes.json();

        // Update Dashboard Stats
        updateDashboardStats();
        
        // Render initial views
        renderEvidenceList();
        renderCaseList();
        renderDrugList();
        renderHerbalList();
        renderDiscoveryInsights();
        renderUnmetNeeds();

        console.log('Mock data loaded successfully');
      } catch (error) {
        console.error('Failed to load mock data:', error);
      }
    }

    // Update Dashboard Stats
    function updateDashboardStats() {
      $('stat-evidence').textContent = evidenceData.length;
      $('stat-evidence-change').textContent = `+${Math.floor(evidenceData.length * 0.15)} this week`;
      
      $('stat-cases').textContent = casesData.length;
      $('stat-cases-change').textContent = `+${Math.floor(casesData.length * 0.12)} this week`;
      
      $('stat-drugs').textContent = drugsData.length;
      $('stat-drugs-change').textContent = `+${Math.floor(drugsData.length * 0.11)} this month`;
      
      const validationRate = ((evidenceData.filter(e => e.governance.confidence === 'High').length / evidenceData.length) * 100).toFixed(1);
      $('stat-validation').textContent = validationRate + '%';
      $('stat-validation-change').textContent = '+1.3% this month';

      // Render Charts
      renderCharts();
      
      // Render Timeline
      renderTimeline();
    }

    // Render Dashboard Charts
    function renderCharts() {
      // Evidence by Type Chart
      const typeChart = $('chartEvidenceType');
      if (typeChart) {
        const typeCounts = evidenceData.reduce((acc, item) => {
          acc[item.evidenceType] = (acc[item.evidenceType] || 0) + 1;
          return acc;
        }, {});

        const total = evidenceData.length;
        const maxCount = Math.max(...Object.values(typeCounts));

        typeChart.innerHTML = Object.entries(typeCounts).map(([type, count]) => {
          const percentage = ((count / total) * 100).toFixed(1);
          const width = ((count / maxCount) * 100).toFixed(1);
          return `
            <div class="chart-bar">
              <div class="chart-label">${type}</div>
              <div class="chart-bar-fill" style="width: ${width}%;">
                <div class="chart-bar-value">${count} (${percentage}%)</div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Confidence Distribution Chart
      const confChart = $('chartConfidence');
      if (confChart) {
        const confCounts = evidenceData.reduce((acc, item) => {
          const conf = item.governance.confidence;
          acc[conf] = (acc[conf] || 0) + 1;
          return acc;
        }, {});

        const total = evidenceData.length;
        const maxCount = Math.max(...Object.values(confCounts));

        confChart.innerHTML = ['High', 'Medium', 'Low'].map(level => {
          const count = confCounts[level] || 0;
          const percentage = ((count / total) * 100).toFixed(1);
          const width = maxCount > 0 ? ((count / maxCount) * 100).toFixed(1) : 0;
          const color = level === 'High' ? 'rgba(46,229,157,0.3)' : 
                        level === 'Medium' ? 'rgba(255,179,71,0.3)' : 'rgba(170,178,214,0.3)';
          return `
            <div class="chart-bar">
              <div class="chart-label">${level}</div>
              <div class="chart-bar-fill" style="width: ${width}%; background: linear-gradient(90deg, ${color}, ${color});">
                <div class="chart-bar-value">${count} (${percentage}%)</div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Gene Distribution Chart
      const geneChart = $('chartGene');
      if (geneChart) {
        const geneCounts = evidenceData.reduce((acc, item) => {
          const gene = item.entities?.gene || 'Unknown';
          acc[gene] = (acc[gene] || 0) + 1;
          return acc;
        }, {});

        const total = evidenceData.length;
        const maxCount = Math.max(...Object.values(geneCounts));

        geneChart.innerHTML = Object.entries(geneCounts).map(([gene, count]) => {
          const percentage = ((count / total) * 100).toFixed(1);
          const width = ((count / maxCount) * 100).toFixed(1);
          const color = gene === 'EGFR' ? 'rgba(122,162,255,0.4)' : 
                        gene === 'ALK' ? 'rgba(46,229,157,0.4)' : 'rgba(170,178,214,0.3)';
          return `
            <div class="chart-bar">
              <div class="chart-label">${gene}</div>
              <div class="chart-bar-fill" style="width: ${width}%; background: linear-gradient(90deg, ${color}, ${color});">
                <div class="chart-bar-value">${count} (${percentage}%)</div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Line of Therapy Chart
      const lotChart = $('chartLineTherapy');
      if (lotChart) {
        const lotCounts = evidenceData.reduce((acc, item) => {
          const lot = item.entities?.lineOfTherapy || 'Unknown';
          acc[lot] = (acc[lot] || 0) + 1;
          return acc;
        }, {});

        const total = evidenceData.length;
        const maxCount = Math.max(...Object.values(lotCounts));

        lotChart.innerHTML = ['1L', '2L', '3L+', 'Unknown'].map(lot => {
          const count = lotCounts[lot] || 0;
          const percentage = ((count / total) * 100).toFixed(1);
          const width = maxCount > 0 ? ((count / maxCount) * 100).toFixed(1) : 0;
          return `
            <div class="chart-bar">
              <div class="chart-label">${lot}</div>
              <div class="chart-bar-fill" style="width: ${width}%;">
                <div class="chart-bar-value">${count} (${percentage}%)</div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Trial Phase Distribution Chart
      const phaseChart = $('chartTrialPhase');
      if (phaseChart) {
        // Extract phases from trial IDs or default to common phases
        const phaseCounts = {
          'Phase I': Math.floor(evidenceData.length * 0.15),
          'Phase II': Math.floor(evidenceData.length * 0.35),
          'Phase III': Math.floor(evidenceData.length * 0.40),
          'Phase IV': Math.floor(evidenceData.length * 0.10)
        };

        const total = Object.values(phaseCounts).reduce((a, b) => a + b, 0);
        const maxCount = Math.max(...Object.values(phaseCounts));

        phaseChart.innerHTML = Object.entries(phaseCounts).map(([phase, count]) => {
          const percentage = ((count / total) * 100).toFixed(1);
          const width = ((count / maxCount) * 100).toFixed(1);
          return `
            <div class="chart-bar">
              <div class="chart-label">${phase}</div>
              <div class="chart-bar-fill" style="width: ${width}%;">
                <div class="chart-bar-value">${count} (${percentage}%)</div>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    // Render Timeline
    function renderTimeline() {
      const timeline = $('recentTimeline');
      if (!timeline) return;

      // Generate timeline from recent evidence and cases
      const activities = [];

      // Add recent evidence items
      evidenceData.slice(0, 3).forEach((item, idx) => {
        activities.push({
          title: 'New Evidence Added',
          desc: `${item.entities?.gene || 'N/A'} ${item.entities?.alteration || ''} â€” ${item.trial?.trialId || item.title.substring(0, 50) + '...'}`,
          time: `${idx + 2} hours ago`
        });
      });

      // Add recent cases
      casesData.filter(c => c.status === 'Active').slice(0, 2).forEach((caseItem, idx) => {
        activities.push({
          title: 'Case Analysis Completed',
          desc: `${caseItem.caseId} â€” ${caseItem.recommendation || caseItem.profile}`,
          time: `${idx + 1} day${idx > 0 ? 's' : ''} ago`
        });
      });

      timeline.innerHTML = activities.slice(0, 5).map(activity => `
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <div class="timeline-title">${activity.title}</div>
            <div class="timeline-desc">${activity.desc}</div>
            <div class="timeline-time">${activity.time}</div>
          </div>
        </div>
      `).join('');
    }

    // Render Evidence List
    function renderEvidenceList(filter = {}) {
      const list = $('evidenceList');
      if (!list) return;

      let filtered = evidenceData;

      // Apply filters
      if (filter.search) {
        const search = filter.search.toLowerCase();
        filtered = filtered.filter(e => 
          e.title.toLowerCase().includes(search) ||
          e.entities?.drugName?.toLowerCase().includes(search) ||
          e.trial?.trialId?.toLowerCase().includes(search)
        );
      }
      if (filter.type) {
        filtered = filtered.filter(e => e.evidenceType === filter.type);
      }
      if (filter.confidence) {
        filtered = filtered.filter(e => e.governance.confidence === filter.confidence);
      }

      if (filtered.length === 0) {
        list.innerHTML = '<p style=\"color: var(--muted); text-align: center; padding: 24px;\">No evidence items found.</p>';
        return;
      }

      list.innerHTML = filtered.map((item, idx) => {
        const confidenceColor = item.governance.confidence === 'High' ? 'var(--ok)' : 
                                 item.governance.confidence === 'Medium' ? 'var(--warning)' : 'var(--muted)';
        return `
          <div class="case-item" onclick="openEvidenceModal('${item.id}')" style="cursor: pointer;">
            <div class="case-header">
              <div class="case-id">${item.id}</div>
              <div class="case-badge" style="background: rgba(122,162,255,0.15); color: var(--accent);">${item.evidenceType}</div>
            </div>
            <div class="case-info">
              <strong>Title:</strong> ${item.title}<br/>
              <strong>Drug:</strong> ${item.entities?.drugName || 'N/A'} | 
              <strong>Gene:</strong> ${item.entities?.gene || 'N/A'} (${item.entities?.alteration || 'N/A'})<br/>
              <strong>Trial ID:</strong> ${item.trial?.trialId || 'N/A'} | 
              <strong>Confidence:</strong> <span style="color: ${confidenceColor};">${item.governance.confidence}</span><br/>
              <strong>Published:</strong> ${item.pubDate}
            </div>
          </div>
        `;
      }).join('');
    }

    // Render Case List
    function renderCaseList(filter = {}) {
      const list = $('caseList');
      if (!list) return;

      let filtered = casesData;

      // Apply filters
      if (filter.search) {
        const search = filter.search.toLowerCase();
        filtered = filtered.filter(c => 
          c.caseId.toLowerCase().includes(search) ||
          c.profile.toLowerCase().includes(search)
        );
      }
      if (filter.status) {
        filtered = filtered.filter(c => c.status === filter.status);
      }

      if (filtered.length === 0) {
        list.innerHTML = '<p style=\"color: var(--muted); text-align: center; padding: 24px;\">No cases found.</p>';
        return;
      }

      list.innerHTML = filtered.map(caseItem => {
        const badgeClass = caseItem.status.toLowerCase();
        const badgeStyle = caseItem.status === 'Active' ? 'background: rgba(46,229,157,0.15); color: var(--ok);' :
                           caseItem.status === 'Draft' ? 'background: rgba(170,178,214,0.15); color: var(--muted);' :
                           caseItem.status === 'Executed' ? 'background: rgba(122,162,255,0.15); color: var(--accent);' :
                           'background: rgba(255,107,107,0.15); color: var(--bad);';

        let infoHtml = `<strong>Profile:</strong> ${caseItem.profile}<br/>`;
        
        if (caseItem.recommendation) {
          infoHtml += `<strong>Recommendation:</strong> ${caseItem.recommendation}<br/>`;
          infoHtml += `<strong>Confidence:</strong> ${(caseItem.confidence * 100).toFixed(0)}% | <strong>Evidence:</strong> ${caseItem.evidence}`;
        } else if (caseItem.nextStep) {
          infoHtml += `<strong>Status:</strong> ${caseItem.nextStep}`;
        } else if (caseItem.decision) {
          infoHtml += `<strong>Decision:</strong> ${caseItem.decision.approvedBy} at ${caseItem.decision.timestamp}`;
        }

        return `
          <div class="case-item" onclick="openCaseModal('${caseItem.caseId}')" style="cursor: pointer;">
            <div class="case-header">
              <div class="case-id">${caseItem.caseId}</div>
              <div class="case-badge" style="${badgeStyle}">${caseItem.status}</div>
            </div>
            <div class="case-info">
              ${infoHtml}
            </div>
          </div>
        `;
      }).join('');
    }

    // Render Drug List
    function renderDrugList(filter = {}, sort = false) {
      const list = $('drugList');
      if (!list) return;

      let filtered = drugsData;

      // Apply filters
      if (filter.gene) {
        filtered = filtered.filter(d => d.targets.includes(filter.gene));
      }
      if (filter.approval === 'FDA') {
        filtered = filtered.filter(d => d.approvals.includes('FDA'));
      } else if (filter.approval === 'EMA') {
        filtered = filtered.filter(d => d.approvals.includes('EMA'));
      } else if (filter.approval === 'Both') {
        filtered = filtered.filter(d => d.approvals.includes('FDA') && d.approvals.includes('EMA'));
      }

      // Sort by confidence
      if (sort) {
        filtered = [...filtered].sort((a, b) => b.confidence - a.confidence);
      }

      if (filtered.length === 0) {
        list.innerHTML = '<p style=\"color: var(--muted); text-align: center; padding: 24px;\">No drugs found.</p>';
        return;
      }

      list.innerHTML = filtered.map(drug => {
        const confidencePercent = (drug.confidence * 100).toFixed(0);
        const confidenceColor = drug.confidence >= 0.9 ? 'var(--ok)' : 
                                 drug.confidence >= 0.7 ? 'var(--warning)' : 'var(--muted)';
        
        const approvalBadges = drug.approvals.map(a => 
          `<span class="pill" style="background: rgba(46,229,157,0.15); color: var(--ok); margin-right: 6px;">${a}</span>`
        ).join('');

        const efficacyMetrics = drug.efficacy ? 
          `<br/><strong>Efficacy:</strong> ORR ${drug.efficacy.orr || 'N/A'}, PFS ${drug.efficacy.pfs || 'N/A'}, OS ${drug.efficacy.os || 'N/A'}` : '';

        return `
          <div class="case-item" onclick="openDrugModal('${drug.drugId}')" style="cursor: pointer;">
            <div class="case-header">
              <div class="case-id">${drug.name}</div>
              <div style="display: flex; gap: 6px;">
                ${approvalBadges}
              </div>
            </div>
            <div class="case-info">
              <strong>Targets:</strong> ${drug.targets.join(', ')} | 
              <strong>MoA:</strong> ${drug.moa}<br/>
              <strong>Trial:</strong> ${drug.linkedTrials.join(', ')}<br/>
              <strong>Confidence:</strong> <span style="color: ${confidenceColor}; font-weight: 600;">${confidencePercent}%</span>
              ${efficacyMetrics}
            </div>
          </div>
        `;
      }).join('');
    }

    // Modal Functions
    function closeModal(modalId) {
      const modal = $(modalId);
      if (modal) {
        modal.classList.remove('active');
      }
    }

    // Close modal on overlay click
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        e.target.classList.remove('active');
      }
    });

    // Close modal on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay.active').forEach(modal => {
          modal.classList.remove('active');
        });
      }
    });

    // Open Evidence Modal
    function openEvidenceModal(evidenceId) {
      const item = evidenceData.find(e => e.id === evidenceId);
      if (!item) return;

      const modal = $('modalEvidence');
      const title = $('modalEvidenceTitle');
      const body = $('modalEvidenceBody');

      title.textContent = item.title;

      const confidenceColor = item.governance.confidence === 'High' ? 'var(--ok)' : 
                               item.governance.confidence === 'Medium' ? 'var(--warning)' : 'var(--muted)';

      body.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Metadata</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Evidence Type</div>
              <div class="modal-meta-value">${item.evidenceType}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Publication Date</div>
              <div class="modal-meta-value">${item.pubDate}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Confidence</div>
              <div class="modal-meta-value" style="color: ${confidenceColor};">${item.governance.confidence}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Trial ID</div>
              <div class="modal-meta-value">${item.trial?.trialId || 'N/A'}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">DOI</div>
              <div class="modal-meta-value">${item.doi || 'N/A'}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Source URL</div>
              <div class="modal-meta-value">${item.sourceUrl ? `<a href="${item.sourceUrl}" target="_blank" style="color: var(--accent);">Link</a>` : 'N/A'}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Abstract / Summary</div>
          <div class="modal-text">${item.rawText?.abstractOrSummary || 'No abstract available.'}</div>
        </div>

        ${item.rawText?.methodsOrNotes ? `
        <div class="modal-section">
          <div class="modal-section-title">Methods / Notes</div>
          <div class="modal-text">${item.rawText.methodsOrNotes}</div>
        </div>
        ` : ''}

        <div class="modal-section">
          <div class="modal-section-title">Entities</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Gene</div>
              <div class="modal-meta-value">${item.entities?.gene || 'N/A'}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Alteration</div>
              <div class="modal-meta-value">${item.entities?.alteration || 'N/A'}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Drug</div>
              <div class="modal-meta-value">${item.entities?.drugName || 'N/A'}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Line of Therapy</div>
              <div class="modal-meta-value">${item.entities?.lineOfTherapy || 'N/A'}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Governance</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Peer Reviewed</div>
              <div class="modal-meta-value">${item.governance?.peerReviewed || 'Unknown'}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Funding</div>
              <div class="modal-meta-value">${item.governance?.funding || 'N/A'}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Conflict of Interest</div>
              <div class="modal-meta-value">${item.governance?.conflictOfInterest || 'Unknown'}</div>
            </div>
          </div>
          ${item.governance?.limitations ? `
          <div style="margin-top: 12px;">
            <div class="modal-meta-label">Limitations</div>
            <div class="modal-text">${item.governance.limitations}</div>
          </div>
          ` : ''}
        </div>
      `;

      modal.classList.add('active');
    }

    // Open Case Modal
    function openCaseModal(caseId) {
      const caseItem = casesData.find(c => c.caseId === caseId);
      if (!caseItem) return;

      const modal = $('modalCase');
      const title = $('modalCaseTitle');
      const body = $('modalCaseBody');

      title.textContent = caseItem.caseId;

      const badgeStyle = caseItem.status === 'Active' ? 'background: rgba(46,229,157,0.15); color: var(--ok);' :
                         caseItem.status === 'Draft' ? 'background: rgba(170,178,214,0.15); color: var(--muted);' :
                         caseItem.status === 'Executed' ? 'background: rgba(122,162,255,0.15); color: var(--accent);' :
                         'background: rgba(255,107,107,0.15); color: var(--bad);';

      // Find related evidence
      const relatedEvidence = evidenceData.filter(e => 
        caseItem.profile.includes(e.entities?.gene || '') || 
        caseItem.profile.includes(e.entities?.alteration || '')
      );

      body.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Status</div>
          <div style="display: inline-block; padding: 6px 12px; border-radius: 8px; ${badgeStyle} font-weight: 600;">
            ${caseItem.status}
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Patient Profile</div>
          <div class="modal-text">${caseItem.profile}</div>
        </div>

        ${caseItem.recommendation ? `
        <div class="modal-section">
          <div class="modal-section-title">Recommendation</div>
          <div class="modal-text">${caseItem.recommendation}</div>
          <div class="modal-meta" style="margin-top: 12px;">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Confidence</div>
              <div class="modal-meta-value">${(caseItem.confidence * 100).toFixed(0)}%</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Evidence Count</div>
              <div class="modal-meta-value">${caseItem.evidence}</div>
            </div>
          </div>
        </div>
        ` : ''}

        ${caseItem.nextStep ? `
        <div class="modal-section">
          <div class="modal-section-title">Next Steps</div>
          <div class="modal-text">${caseItem.nextStep}</div>
        </div>
        ` : ''}

        ${caseItem.decision ? `
        <div class="modal-section">
          <div class="modal-section-title">Decision</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Approved By</div>
              <div class="modal-meta-value">${caseItem.decision.approvedBy}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Timestamp</div>
              <div class="modal-meta-value">${caseItem.decision.timestamp}</div>
            </div>
          </div>
        </div>
        ` : ''}

        <div class="modal-section">
          <div class="modal-section-title">Related Evidence (${relatedEvidence.length})</div>
          ${relatedEvidence.length > 0 ? `
            <ul class="modal-list">
              ${relatedEvidence.map(e => `
                <li>
                  <strong>${e.title}</strong><br/>
                  <span style="color: var(--muted); font-size: 12px;">
                    ${e.evidenceType} â€¢ ${e.entities?.gene} ${e.entities?.alteration} â€¢ ${e.trial?.trialId || 'N/A'}
                  </span>
                </li>
              `).join('')}
            </ul>
          ` : '<div class="modal-text" style="color: var(--muted);">No related evidence found.</div>'}
        </div>
      `;

      modal.classList.add('active');
    }

    // Open Drug Modal
    function openDrugModal(drugId) {
      const drug = drugsData.find(d => d.drugId === drugId);
      if (!drug) return;

      const modal = $('modalDrug');
      const title = $('modalDrugTitle');
      const body = $('modalDrugBody');

      title.textContent = drug.name;

      const confidencePercent = (drug.confidence * 100).toFixed(0);
      const confidenceColor = drug.confidence >= 0.9 ? 'var(--ok)' : 
                               drug.confidence >= 0.7 ? 'var(--warning)' : 'var(--muted)';

      const approvalBadges = drug.approvals.map(a => 
        `<span class="pill" style="background: rgba(46,229,157,0.15); color: var(--ok); padding: 6px 12px; font-size: 13px;">${a} Approved</span>`
      ).join(' ');

      // Find related trials in evidence
      const relatedTrials = evidenceData.filter(e => 
        drug.linkedTrials.some(trial => e.trial?.trialId === trial) ||
        e.entities?.drugName?.toLowerCase().includes(drug.name.toLowerCase())
      );

      body.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Approval Status</div>
          <div>${approvalBadges}</div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Drug Information</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Targets</div>
              <div class="modal-meta-value">${drug.targets.join(', ')}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Mechanism of Action</div>
              <div class="modal-meta-value">${drug.moa}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Confidence Score</div>
              <div class="modal-meta-value" style="color: ${confidenceColor}; font-weight: 600;">${confidencePercent}%</div>
            </div>
          </div>
        </div>

        ${drug.efficacy ? `
        <div class="modal-section">
          <div class="modal-section-title">Efficacy Metrics</div>
          <div class="modal-meta">
            ${drug.efficacy.orr ? `
            <div class="modal-meta-item">
              <div class="modal-meta-label">Objective Response Rate</div>
              <div class="modal-meta-value">${drug.efficacy.orr}</div>
            </div>
            ` : ''}
            ${drug.efficacy.pfs ? `
            <div class="modal-meta-item">
              <div class="modal-meta-label">Progression-Free Survival</div>
              <div class="modal-meta-value">${drug.efficacy.pfs}</div>
            </div>
            ` : ''}
            ${drug.efficacy.os ? `
            <div class="modal-meta-item">
              <div class="modal-meta-label">Overall Survival</div>
              <div class="modal-meta-value">${drug.efficacy.os}</div>
            </div>
            ` : ''}
          </div>
        </div>
        ` : ''}

        <div class="modal-section">
          <div class="modal-section-title">Linked Clinical Trials (${drug.linkedTrials.length})</div>
          <ul class="modal-list">
            ${drug.linkedTrials.map(trial => `<li><strong>${trial}</strong></li>`).join('')}
          </ul>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Related Evidence (${relatedTrials.length})</div>
          ${relatedTrials.length > 0 ? `
            <ul class="modal-list">
              ${relatedTrials.map(e => `
                <li>
                  <strong>${e.title}</strong><br/>
                  <span style="color: var(--muted); font-size: 12px;">
                    ${e.evidenceType} â€¢ ${e.trial?.trialId || 'N/A'} â€¢ ${e.pubDate}
                  </span>
                </li>
              `).join('')}
            </ul>
          ` : '<div class="modal-text" style="color: var(--muted);">No related evidence found.</div>'}
        </div>
      `;

      modal.classList.add('active');
    }

    // Render Herbal Compounds
    function renderHerbalList(filter = {}) {
      const list = $('herbalList');
      if (!list) return;

      let filtered = herbalData;

      if (filter.search) {
        const search = filter.search.toLowerCase();
        filtered = filtered.filter(h => 
          h.name.toLowerCase().includes(search) ||
          h.source.toLowerCase().includes(search) ||
          h.koreanName.toLowerCase().includes(search) ||
          h.targets.some(t => t.toLowerCase().includes(search))
        );
      }
      if (filter.status) {
        filtered = filtered.filter(h => h.clinicalStatus === filter.status);
      }

      if (filtered.length === 0) {
        list.innerHTML = '<p style="color: var(--muted); text-align: center; padding: 24px;">No herbal compounds found.</p>';
        return;
      }

      list.innerHTML = filtered.map(herb => {
        const statusColor = herb.clinicalStatus.includes('III') ? 'var(--ok)' :
                            herb.clinicalStatus.includes('II') ? 'var(--warning)' : 'var(--muted)';
        
        return `
          <div class="case-item" onclick="openHerbalModal('${herb.id}')" style="cursor: pointer;">
            <div class="case-header">
              <div class="case-id">${herb.name} (${herb.koreanName})</div>
              <div class="case-badge" style="background: rgba(46,229,157,0.15); color: ${statusColor};">${herb.clinicalStatus}</div>
            </div>
            <div class="case-info">
              <strong>Source:</strong> ${herb.source} | <strong>Category:</strong> ${herb.category}<br/>
              <strong>Targets:</strong> ${herb.targets.join(', ')} | <strong>MoA:</strong> ${herb.moa}<br/>
              <strong>Potential:</strong> ${herb.potentialIndications.join(', ')}<br/>
              ${herb.discoveryInsight ? `<div style="margin-top: 6px; color: var(--accent); font-weight: 600;">${herb.discoveryInsight}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    // Render Discovery Insights
    function renderDiscoveryInsights() {
      // Top Opportunities
      const topList = $('topOpportunities');
      if (topList && discoveryInsights.candidateDiscovery) {
        const topCandidates = discoveryInsights.candidateDiscovery
          .sort((a, b) => b.discoveryScore - a.discoveryScore)
          .slice(0, 3);

        topList.innerHTML = topCandidates.map(candidate => `
          <div class="case-item" style="border-left: 3px solid var(--bad);">
            <div class="case-header">
              <div class="case-id">${candidate.name}</div>
              <div style="display: flex; gap: 6px; align-items: center;">
                <div class="case-badge" style="background: rgba(255,107,107,0.15); color: var(--bad);">Score: ${candidate.discoveryScore}/10</div>
              </div>
            </div>
            <div class="case-info">
              <strong>Type:</strong> ${candidate.type} | <strong>Target:</strong> ${candidate.target}<br/>
              <strong>Hypothesis:</strong> ${candidate.hypothesis}<br/>
              <strong>Development:</strong> ${candidate.developmentPath} | <strong>Timeline:</strong> ${candidate.estimatedTimeline}<br/>
              <div style="margin-top: 8px;">
                ${candidate.tags.map(tag => `<span class="pill" style="margin-right: 6px; background: rgba(255,107,107,0.15); color: var(--bad);">${tag}</span>`).join('')}
              </div>
            </div>
          </div>
        `).join('');
      }

      // Candidates List
      const candidatesList = $('candidatesList');
      if (candidatesList && discoveryInsights.candidateDiscovery) {
        candidatesList.innerHTML = discoveryInsights.candidateDiscovery.map(candidate => `
          <div class="case-item" onclick="openCandidateModal('${candidate.id}')" style="cursor: pointer;">
            <div class="case-header">
              <div class="case-id">${candidate.name}</div>
              <div style="display: flex; gap: 6px;">
                <span class="pill" style="background: rgba(122,162,255,0.15); color: var(--accent);">Score: ${candidate.discoveryScore}/10</span>
              </div>
            </div>
            <div class="case-info">
              <strong>Type:</strong> ${candidate.type}<br/>
              <strong>Hypothesis:</strong> ${candidate.hypothesis}<br/>
              <strong>Novelty:</strong> ${candidate.novelty} | <strong>Patentability:</strong> ${candidate.patentability}
            </div>
          </div>
        `).join('');
      }

      // Knowledge Gaps
      const gapsList = $('knowledgeGapsList');
      if (gapsList && discoveryInsights.knowledgeGaps) {
        gapsList.innerHTML = discoveryInsights.knowledgeGaps.map(gap => `
          <div class="stat-card">
            <div class="stat-label">${gap.area}</div>
            <div style="font-size: 13px; color: var(--text); margin: 8px 0; line-height: 1.5;">${gap.description}</div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span class="pill">Evidence: ${gap.evidenceCount}</span>
              <span class="pill" style="background: ${gap.impact === 'High' ? 'rgba(255,107,107,0.15)' : 'rgba(255,179,71,0.15)'}; color: ${gap.impact === 'High' ? 'var(--bad)' : 'var(--warning)'};">${gap.impact} Impact</span>
            </div>
          </div>
        `).join('');
      }
    }

    // Render Unmet Needs
    function renderUnmetNeeds(filter = {}) {
      const list = $('unmetNeedsList');
      if (!list || !discoveryInsights.unmetNeeds) return;

      let filtered = discoveryInsights.unmetNeeds;

      if (filter.priority) {
        filtered = filtered.filter(u => u.priority === filter.priority);
      }
      if (filter.category) {
        filtered = filtered.filter(u => u.category === filter.category);
      }

      if (filtered.length === 0) {
        list.innerHTML = '<p style="color: var(--muted); text-align: center; padding: 24px;">No unmet needs found.</p>';
        return;
      }

      list.innerHTML = filtered.map(need => {
        const priorityColor = need.priority === 'Critical' ? 'var(--bad)' :
                              need.priority === 'High' ? 'var(--warning)' : 'var(--muted)';
        return `
          <div class="case-item" onclick="openUnmetNeedModal('${need.id}')" style="cursor: pointer; border-left: 3px solid ${priorityColor};">
            <div class="case-header">
              <div class="case-id">${need.title}</div>
              <div class="case-badge" style="background: rgba(255,107,107,0.15); color: ${priorityColor};">${need.priority}</div>
            </div>
            <div class="case-info">
              <strong>Category:</strong> ${need.category} | <strong>Affected:</strong> ${need.affectedPatients}<br/>
              <strong>Current Gap:</strong> ${need.currentGap}<br/>
              <strong>Evidence Count:</strong> ${need.evidenceCount} | <strong>Genes:</strong> ${need.relatedGenes.join(', ')}<br/>
              ${need.discoveryOpportunity ? `<div style="margin-top: 6px; color: ${priorityColor}; font-weight: 600;">${need.discoveryOpportunity}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');

      // Render Drug Repurposing
      const repurposingList = $('repurposingList');
      if (repurposingList && discoveryInsights.drugRepurposingOpportunities) {
        repurposingList.innerHTML = discoveryInsights.drugRepurposingOpportunities.map(drug => {
          const priorityColor = drug.priority === 'High' ? 'var(--ok)' : 'var(--warning)';
          return `
            <div class="case-item" onclick="openRepurposingModal('${drug.id}')" style="cursor: pointer;">
              <div class="case-header">
                <div class="case-id">${drug.drug}</div>
                <div class="case-badge" style="background: rgba(46,229,157,0.15); color: ${priorityColor};">${drug.priority} Priority</div>
              </div>
              <div class="case-info">
                <strong>Current Use:</strong> ${drug.currentIndication} â†’ <strong>Proposed:</strong> ${drug.proposedIndication}<br/>
                <strong>Rationale:</strong> ${drug.rationale}<br/>
                <strong>Feasibility:</strong> ${drug.feasibility} | <strong>Cost:</strong> ${drug.estimatedCost}<br/>
                ${drug.discoveryInsight ? `<div style="margin-top: 6px; color: var(--ok); font-weight: 600;">${drug.discoveryInsight}</div>` : ''}
              </div>
            </div>
          `;
        }).join('');
      }
    }

    // Setup Herbal Filters
    function setupHerbalFilters() {
      const searchInput = $('herbalSearch');
      const statusFilter = $('herbalFilterStatus');

      if (!searchInput) return;

      const applyFilters = () => {
        renderHerbalList({
          search: searchInput.value,
          status: statusFilter.value
        });
      };

      searchInput.addEventListener('input', applyFilters);
      statusFilter.addEventListener('change', applyFilters);
    }

    // Setup Unmet Needs Filters
    function setupUnmetFilters() {
      const priorityFilter = $('unmetFilterPriority');
      const categoryFilter = $('unmetFilterCategory');

      if (!priorityFilter) return;

      const applyFilters = () => {
        renderUnmetNeeds({
          priority: priorityFilter.value,
          category: categoryFilter.value
        });
      };

      priorityFilter.addEventListener('change', applyFilters);
      categoryFilter.addEventListener('change', applyFilters);
    }

    // Open Herbal Modal
    function openHerbalModal(herbId) {
      const herb = herbalData.find(h => h.id === herbId);
      if (!herb) return;

      const modal = $('modalEvidence');
      const title = $('modalEvidenceTitle');
      const body = $('modalEvidenceBody');

      title.textContent = `${herb.name} (${herb.koreanName})`;

      const statusColor = herb.clinicalStatus.includes('III') ? 'var(--ok)' :
                          herb.clinicalStatus.includes('II') ? 'var(--warning)' : 'var(--muted)';

      body.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Basic Information</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Source</div>
              <div class="modal-meta-value">${herb.source}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Category</div>
              <div class="modal-meta-value">${herb.category}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Clinical Status</div>
              <div class="modal-meta-value" style="color: ${statusColor};">${herb.clinicalStatus}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Mechanism & Targets</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Mechanism of Action</div>
              <div class="modal-meta-value">${herb.moa}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Targets</div>
              <div class="modal-meta-value">${herb.targets.join(', ')}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Preclinical Evidence</div>
          <div class="modal-text">
            <strong>Cell Lines:</strong> ${herb.preclinicalEvidence.cellLines.join(', ')}<br/>
            <strong>IC50 Range:</strong> ${herb.preclinicalEvidence.ic50Range}<br/>
            <strong>Mechanism Notes:</strong> ${herb.preclinicalEvidence.mechanismNotes}
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Development Potential</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Combination Potential</div>
              <div class="modal-meta-value">${herb.combinationPotential.join(', ')}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Synergy</div>
              <div class="modal-meta-value">${herb.synergy}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Safety Profile</div>
              <div class="modal-meta-value">${herb.safetyProfile}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Bioavailability</div>
              <div class="modal-meta-value">${herb.bioavailability}</div>
            </div>
          </div>
        </div>

        ${herb.discoveryInsight ? `
        <div class="modal-section">
          <div class="modal-section-title">Discovery Insight</div>
          <div class="modal-text" style="color: var(--accent); font-weight: 600; font-size: 15px;">
            ${herb.discoveryInsight}
          </div>
        </div>
        ` : ''}

        <div class="modal-section">
          <div class="modal-section-title">Potential Indications</div>
          <ul class="modal-list">
            ${herb.potentialIndications.map(ind => `<li>${ind}</li>`).join('')}
          </ul>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">References</div>
          <ul class="modal-list">
            ${herb.references.map(ref => `<li><a href="https://pubmed.ncbi.nlm.nih.gov/${ref.replace('PMID:', '')}/" target="_blank" style="color: var(--accent);">${ref}</a></li>`).join('')}
          </ul>
        </div>
      `;

      modal.classList.add('active');
    }

    // Open Candidate Modal (ì‹ ì•½ í›„ë³´ë¬¼ì§ˆ)
    function openCandidateModal(candidateId) {
      const candidate = discoveryInsights.candidateDiscovery?.find(c => c.id === candidateId);
      if (!candidate) return;

      const modal = $('modalCase');
      const title = $('modalCaseTitle');
      const body = $('modalCaseBody');

      title.textContent = candidate.name;

      body.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Discovery Score</div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="font-size: 32px; font-weight: 700; color: var(--accent);">${candidate.discoveryScore}/10</div>
            <div style="flex: 1;">
              <div style="background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: var(--accent); height: 100%; width: ${candidate.discoveryScore * 10}%;"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Candidate Information</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Type</div>
              <div class="modal-meta-value">${candidate.type}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Target</div>
              <div class="modal-meta-value">${candidate.target}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Development Path</div>
              <div class="modal-meta-value">${candidate.developmentPath}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Timeline</div>
              <div class="modal-meta-value">${candidate.estimatedTimeline}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Hypothesis</div>
          <div class="modal-text">${candidate.hypothesis}</div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Supporting Evidence</div>
          <ul class="modal-list">
            ${candidate.supportingEvidence.map(ev => `<li>${ev}</li>`).join('')}
          </ul>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Development Assessment</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Novelty</div>
              <div class="modal-meta-value">${candidate.novelty}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Patentability</div>
              <div class="modal-meta-value">${candidate.patentability}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Funding Potential</div>
              <div class="modal-meta-value">${candidate.fundingPotential}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Tags</div>
          <div>
            ${candidate.tags.map(tag => `<span class="pill" style="margin-right: 8px; background: rgba(122,162,255,0.15); color: var(--accent);">${tag}</span>`).join('')}
          </div>
        </div>
      `;

      modal.classList.add('active');
    }

    // Open Unmet Need Modal
    function openUnmetNeedModal(needId) {
      const need = discoveryInsights.unmetNeeds?.find(n => n.id === needId);
      if (!need) return;

      const modal = $('modalDrug');
      const title = $('modalDrugTitle');
      const body = $('modalDrugBody');

      title.textContent = need.title;

      const priorityColor = need.priority === 'Critical' ? 'var(--bad)' :
                            need.priority === 'High' ? 'var(--warning)' : 'var(--muted)';

      body.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Priority & Category</div>
          <div style="display: flex; gap: 12px; align-items: center;">
            <span class="pill" style="background: rgba(255,107,107,0.15); color: ${priorityColor}; font-size: 14px; padding: 8px 16px;">${need.priority} Priority</span>
            <span class="pill" style="background: rgba(122,162,255,0.15); color: var(--accent); font-size: 14px; padding: 8px 16px;">${need.category}</span>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Description</div>
          <div class="modal-text">${need.description}</div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Impact Assessment</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Affected Patients</div>
              <div class="modal-meta-value">${need.affectedPatients}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Current Gap</div>
              <div class="modal-meta-value">${need.currentGap}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Evidence Count</div>
              <div class="modal-meta-value">${need.evidenceCount}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Related Genes & Alterations</div>
          <div class="modal-text">
            <strong>Genes:</strong> ${need.relatedGenes.join(', ')}<br/>
            <strong>Alterations:</strong> ${need.relatedAlterations.join(', ')}
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Potential Solutions</div>
          <ul class="modal-list">
            ${need.potentialSolutions.map(sol => `<li>${sol}</li>`).join('')}
          </ul>
        </div>

        ${need.discoveryOpportunity ? `
        <div class="modal-section">
          <div class="modal-section-title">Discovery Opportunity</div>
          <div class="modal-text" style="color: ${priorityColor}; font-weight: 600; font-size: 15px;">
            ${need.discoveryOpportunity}
          </div>
        </div>
        ` : ''}
      `;

      modal.classList.add('active');
    }

    // Open Repurposing Modal
    function openRepurposingModal(drugId) {
      const drug = discoveryInsights.drugRepurposingOpportunities?.find(d => d.id === drugId);
      if (!drug) return;

      const modal = $('modalDrug');
      const title = $('modalDrugTitle');
      const body = $('modalDrugBody');

      title.textContent = `${drug.drug} Repurposing`;

      const priorityColor = drug.priority === 'High' ? 'var(--ok)' : 'var(--warning)';

      body.innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Repurposing Opportunity</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Current Indication</div>
              <div class="modal-meta-value">${drug.currentIndication}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Proposed Indication</div>
              <div class="modal-meta-value" style="color: var(--accent);">${drug.proposedIndication}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Priority</div>
              <div class="modal-meta-value" style="color: ${priorityColor};">${drug.priority}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Scientific Rationale</div>
          <div class="modal-text">${drug.rationale}</div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Evidence</div>
          <div class="modal-text">
            <strong>Preclinical:</strong> ${drug.preclinicalEvidence}<br/>
            <strong>Clinical:</strong> ${drug.clinicalEvidence}
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Feasibility Assessment</div>
          <div class="modal-meta">
            <div class="modal-meta-item">
              <div class="modal-meta-label">Feasibility</div>
              <div class="modal-meta-value">${drug.feasibility}</div>
            </div>
            <div class="modal-meta-item">
              <div class="modal-meta-label">Estimated Cost</div>
              <div class="modal-meta-value">${drug.estimatedCost}</div>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Proposed Clinical Trial</div>
          <div class="modal-text">${drug.trialProposal}</div>
        </div>

        ${drug.discoveryInsight ? `
        <div class="modal-section">
          <div class="modal-section-title">Discovery Insight</div>
          <div class="modal-text" style="color: var(--ok); font-weight: 600; font-size: 15px;">
            ${drug.discoveryInsight}
          </div>
        </div>
        ` : ''}
      `;

      modal.classList.add('active');
    }

    // Load data on page load
    loadMockData();

    // Sidebar toggle
    const sidebar = $('sidebar');
    const toggleBtn = $('toggleSidebar');
    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
    });

    // Navigation
    const navItems = document.querySelectorAll('.nav-item');
    const pages = document.querySelectorAll('.page-content');

    function navigateTo(pageName) {
      // Update nav items
      navItems.forEach(item => {
        if (item.dataset.page === pageName) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });

      // Update pages
      pages.forEach(page => {
        if (page.id === 'page-' + pageName) {
          page.classList.add('active');
        } else {
          page.classList.remove('active');
        }
      });

      // Scroll to top
      window.scrollTo(0, 0);
    }

    navItems.forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const pageName = item.dataset.page;
        navigateTo(pageName);
      });
    });

    // Hydrate form tabs
    const tabs = Array.from(document.querySelectorAll(".tab"));
    tabs.forEach(t => t.addEventListener("click", () => {
      tabs.forEach(x => x.classList.remove("active"));
      t.classList.add("active");
      const tab = t.dataset.tab;
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      $("sec-" + tab).classList.add("active");
    }));

    // Auto fields
    function syncDerived() {
      const cancer = $("cancerType").value;
      const altText = $("alteration").selectedOptions[0]?.textContent || "";
      $("subgroupLabel").value = `${cancer} + ${altText}`;
      $("targets").value = $("geneFocus").value;
    }
    ["cancerType","alteration","geneFocus"].forEach(id => $(id).addEventListener("change", syncDerived));
    syncDerived();

    // Simple validation
    function validateRequired() {
      const required = [
        ["pubDate","Publication Date"],
        ["title","Title"],
        ["abstractText","Abstract/Summary Text"],
        ["geneFocus","Gene Focus"],
        ["alteration","Alteration"],
        ["drugName","Drug Name"],
        ["metric","Metric"],
        ["value","Value"],
        ["unit","Unit"],
      ];

      const missing = [];
      for (const [id, name] of required) {
        const el = $(id);
        const v = (el.value || "").trim();
        if (!v) missing.push(name);
      }
      return missing;
    }

    function setStatus(ok, msg){
      const dot = $("dot");
      dot.classList.remove("ok","bad");
      dot.classList.add(ok ? "ok" : "bad");
      $("statusText").textContent = msg;
    }

    function buildPayload(){
      const missing = validateRequired();
      if (missing.length) {
        setStatus(false, "í•„ìˆ˜ ëˆ„ë½: " + missing.join(", "));
        return null;
      }

      const evidenceType = $("evidenceType").value;
      const payload = {
        hydrate_version: "1.0",
        scope: { cancerType: "NSCLC", focus: $("geneFocus").value, axis: "Paper+TrialSummary" },

        evidenceItem: {
          type: evidenceType,
          title: $("title").value.trim(),
          publicationDate: $("pubDate").value,
          doi: $("doi").value.trim() || null,
          sourceUrl: $("sourceUrl").value.trim() || null,
          authorsOrOrg: $("authors").value.trim() || null,
          venue: $("venue").value.trim() || null,
          trial: $("trialId").value.trim() ? { trialId: $("trialId").value.trim() } : null,

          rawText: {
            abstractOrSummary: $("abstractText").value.trim(),
            methodsOrNotes: $("methodsText").value.trim() || null
          },

          governance: {
            peerReviewed: $("peerReviewed").value,
            confidence: $("confidence").value,
            limitations: $("limitations").value.trim() || null,
            funding: $("funding").value.trim() || null,
            conflictOfInterest: $("coi").value
          }
        },

        entities: {
          cancerType: $("cancerType").value,
          gene: $("geneFocus").value,
          alteration: $("alteration").value,
          subgroupLabel: $("subgroupLabel").value,
          lineOfTherapy: $("lot").value || null,
          compound: {
            name: $("drugName").value.trim(),
            moa: $("moa").value || null,
            targets: [$("geneFocus").value]
          }
        },

        observation: {
          metric: $("metric").value,
          value: Number($("value").value),
          unit: $("unit").value,
          note: $("resultNotes").value.trim() || null
        },

        proposal: {
          status: "Draft",
          text: null
        }
      };

      setStatus(true, "OK: Hydrate JSON ìƒì„± ì™„ë£Œ (íŒë‹¨/ì¶”ì²œ ì—†ì´ ê·¼ê±°+ë§¥ë½ ë³´ì¡´)");
      return payload;
    }

    // Buttons
    $("btnBuild").addEventListener("click", () => {
      const payload = buildPayload();
      if (payload) $("preview").textContent = JSON.stringify(payload, null, 2);
    });

    $("btnClear").addEventListener("click", () => {
      document.querySelectorAll("input, textarea").forEach(el => {
        if (el.type !== "date" && el.id !== "subgroupLabel" && el.id !== "targets") el.value = "";
        if (el.type === "date") el.value = "";
      });
      $("evidenceType").value = "Paper";
      $("cancerType").value = "NSCLC";
      $("geneFocus").value = "EGFR";
      $("alteration").value = "EGFR_ex19del";
      $("metric").value = "ORR";
      $("unit").value = "%";
      $("peerReviewed").value = "unknown";
      $("confidence").value = "Medium";
      $("coi").value = "unknown";
      $("lot").value = "";
      $("moa").value = "";
      syncDerived();
      $("preview").textContent = "{}";
      const dot = $("dot"); dot.classList.remove("ok","bad");
      $("statusText").textContent = "ì´ˆê¸°í™” ì™„ë£Œ. í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ë©´ JSONì´ ìƒì„±ë©ë‹ˆë‹¤.";
    });

    $("btnExample").addEventListener("click", () => {
      $("evidenceType").value = "TrialSummary";
      $("pubDate").value = "2026-01-08";
      $("title").value = "Trial summary: EGFR inhibitor in 1L NSCLC (exon19del cohort)";
      $("trialId").value = "NCT01234567";
      $("sourceUrl").value = "https://example.org/trial-summary";
      $("authors").value = "Sponsor: Example Pharma";
      $("venue").value = "ASCO (summary)";
      $("abstractText").value =
`Objective: Evaluate 1L EGFR inhibitor in NSCLC with EGFR exon19 del.
Endpoints: ORR, PFS.
Results: ORR 62%, median PFS 14.2 months (data cutoff 2025-12-31).
Safety: manageable. Limitations: single-arm, small N.`;
      $("methodsText").value = "Cohort: EGFR exon19del, treatment-naÃ¯ve. Single-arm.";
      $("geneFocus").value = "EGFR";
      $("alteration").value = "EGFR_ex19del";
      $("lot").value = "1L";
      $("drugName").value = "Drug_A";
      $("moa").value = "TKI";
      $("metric").value = "ORR";
      $("value").value = "62";
      $("unit").value = "%";
      $("resultNotes").value = "cutoff: 2025-12-31; single-arm; small N";
      $("peerReviewed").value = "unknown";
      $("confidence").value = "Medium";
      $("limitations").value = "Single-arm; small sample size; immature OS.";
      $("funding").value = "Pharma";
      $("coi").value = "unknown";
      syncDerived();

      const payload = buildPayload();
      if (payload) $("preview").textContent = JSON.stringify(payload, null, 2);
    });

    // Live status update on key fields
    ["pubDate","title","abstractText","drugName","value"].forEach(id => {
      $(id).addEventListener("input", () => {
        const missing = validateRequired();
        if (missing.length) {
          setStatus(false, "í•„ìˆ˜ ëˆ„ë½: " + missing.join(", "));
        } else {
          setStatus(true, "í•„ìˆ˜ ì¶©ì¡±: 'Hydrate JSON ìƒì„±'ì„ ëˆŒëŸ¬ ì €ì¥í•˜ì„¸ìš”.");
        }
      });
    });

    // Evidence Library Filters
    function setupEvidenceFilters() {
      const searchInput = $('evidenceSearch');
      const typeFilter = $('evidenceFilterType');
      const confidenceFilter = $('evidenceFilterConfidence');

      if (!searchInput) return;

      const applyFilters = () => {
        renderEvidenceList({
          search: searchInput.value,
          type: typeFilter.value,
          confidence: confidenceFilter.value
        });
      };

      searchInput.addEventListener('input', applyFilters);
      typeFilter.addEventListener('change', applyFilters);
      confidenceFilter.addEventListener('change', applyFilters);
    }

    // Case Filters
    function setupCaseFilters() {
      const searchInput = $('caseSearch');
      const statusFilter = $('caseFilterStatus');

      if (!searchInput) return;

      const applyFilters = () => {
        renderCaseList({
          search: searchInput.value,
          status: statusFilter.value
        });
      };

      searchInput.addEventListener('input', applyFilters);
      statusFilter.addEventListener('change', applyFilters);
    }

    // Drug Filters
    function setupDrugFilters() {
      const geneFilter = $('drugFilterGene');
      const approvalFilter = $('drugFilterApproval');
      const sortBtn = $('sortByConfidence');

      if (!geneFilter) return;

      let isSorted = false;

      const applyFilters = () => {
        renderDrugList({
          gene: geneFilter.value,
          approval: approvalFilter.value
        }, isSorted);
      };

      geneFilter.addEventListener('change', applyFilters);
      approvalFilter.addEventListener('change', applyFilters);
      
      sortBtn.addEventListener('click', () => {
        isSorted = !isSorted;
        sortBtn.textContent = isSorted ? 'Sort by Confidence â†‘' : 'Sort by Confidence â†“';
        applyFilters();
      });
    }

    // Setup filters when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      setupEvidenceFilters();
      setupCaseFilters();
      setupDrugFilters();
      setupHerbalFilters();
      setupUnmetFilters();
    });

    // Setup filters after navigation
    const originalNavigateTo = navigateTo;
    navigateTo = function(pageName) {
      originalNavigateTo(pageName);
      setTimeout(() => {
        setupEvidenceFilters();
        setupCaseFilters();
        setupDrugFilters();
        setupHerbalFilters();
        setupUnmetFilters();
      }, 100);
    };
  </script>
</body>
</html>
