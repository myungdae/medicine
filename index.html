<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hydrate Ontology â€” Article Ingestion Form (NSCLC EGFR/ALK)</title>
  <style>
    :root { --bg:#0b1020; --card:#111a33; --line:#263158; --text:#e9ecff; --muted:#aab2d6; --accent:#7aa2ff; --bad:#ff6b6b; --ok:#2ee59d; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; background: linear-gradient(180deg, #070a14, var(--bg)); color: var(--text); }
    header { padding: 22px 18px; border-bottom: 1px solid rgba(255,255,255,0.06); position: sticky; top:0; backdrop-filter: blur(8px); background: rgba(7,10,20,0.75); z-index: 5; }
    header h1 { margin:0; font-size: 18px; letter-spacing: .2px; }
    header .sub { margin-top:6px; color: var(--muted); font-size: 13px; line-height: 1.35; }
    main { max-width: 1100px; margin: 0 auto; padding: 18px; display: grid; grid-template-columns: 1.2fr .8fr; gap: 14px; }
    @media (max-width: 980px){ main { grid-template-columns: 1fr; } }

    .card { background: rgba(17,26,51,.92); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .card h2 { margin: 2px 0 12px; font-size: 15px; }
    .grid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; }
    .grid3 { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 10px; }
    .row { display:flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    label { display:block; font-size: 12px; color: var(--muted); margin: 0 0 6px; }
    input, select, textarea {
      width: 100%; padding: 10px 10px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.10); background: rgba(7,10,20,0.65);
      color: var(--text); outline: none;
    }
    textarea { min-height: 120px; resize: vertical; }
    input:focus, select:focus, textarea:focus { border-color: rgba(122,162,255,0.55); box-shadow: 0 0 0 3px rgba(122,162,255,0.12); }
    .hint { font-size: 12px; color: var(--muted); margin-top: 6px; line-height: 1.35; }
    .pill { display:inline-flex; align-items:center; gap:6px; font-size: 12px; border: 1px solid rgba(255,255,255,0.10); padding: 6px 10px; border-radius: 999px; color: var(--muted); }
    .pill b { color: var(--text); font-weight: 600; }
    .tabs { display:flex; gap:8px; flex-wrap: wrap; margin-bottom: 10px; }
    .tab {
      cursor:pointer; user-select:none;
      padding: 8px 10px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.10);
      color: var(--muted); background: rgba(7,10,20,0.35);
      font-size: 12px;
    }
    .tab.active { color: var(--text); border-color: rgba(122,162,255,0.45); background: rgba(122,162,255,0.12); }
    .section { display:none; }
    .section.active { display:block; }
    .btns { display:flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end; margin-top: 10px; }
    button {
      cursor:pointer; border: 1px solid rgba(255,255,255,0.12);
      background: rgba(122,162,255,0.14); color: var(--text);
      padding: 10px 12px; border-radius: 12px; font-weight: 600;
    }
    button.secondary { background: rgba(7,10,20,0.55); color: var(--muted); }
    button.danger { background: rgba(255,107,107,0.12); border-color: rgba(255,107,107,0.25); }
    button:hover { filter: brightness(1.05); }
    .status { display:flex; align-items:center; gap:8px; margin-top: 8px; font-size: 12px; color: var(--muted); }
    .dot { width:10px; height:10px; border-radius: 50%; background: rgba(255,255,255,0.20); border:1px solid rgba(255,255,255,0.10); }
    .dot.ok { background: rgba(46,229,157,0.65); border-color: rgba(46,229,157,0.35); }
    .dot.bad { background: rgba(255,107,107,0.65); border-color: rgba(255,107,107,0.35); }
    pre {
      margin: 0; padding: 12px; border-radius: 12px; overflow:auto;
      background: rgba(7,10,20,0.65); border: 1px solid rgba(255,255,255,0.08);
      color: #dbe3ff; font-size: 12px; line-height: 1.45;
    }
    .req { color: var(--accent); margin-left: 4px; }
    .small { font-size: 11px; color: var(--muted); }
  </style>
</head>

<body>
<header>
  <h1>Hydrate Ontology ì…ë ¥ì°½ â€” NSCLC (EGFR/ALK) / Paper + TrialSummary</h1>
  <div class="sub">
    ì´ í™”ë©´ì˜ ëª©ì ì€ <b>íŒë‹¨(ì¶”ì²œ)</b>ì´ ì•„ë‹ˆë¼ <b>ì¦ê±°(Article)ì™€ ê´€ì¸¡ê°’(Observation/Result)ì˜ ë§¥ë½ ë³´ì¡´</b>ì…ë‹ˆë‹¤.
    <span class="pill" style="margin-left:8px;">MoE Expert: <b>Human Curator</b></span>
  </div>
</header>

<main>
  <!-- LEFT: FORM -->
  <section class="card">
    <h2>1) Article ì…ë ¥ (Hydrate)</h2>

    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="meta">ë©”íƒ€ë°ì´í„°</div>
      <div class="tab" data-tab="content">ì›ë¬¸/ìš”ì•½ ì…ë ¥</div>
      <div class="tab" data-tab="entities">ì—”í‹°í‹°/ì½”í˜¸íŠ¸</div>
      <div class="tab" data-tab="results">ê²°ê³¼ ìˆ˜ì¹˜(ORR/PFS...)</div>
      <div class="tab" data-tab="governance">ì‹ ë¢°ë„/ê±°ë²„ë„ŒìŠ¤</div>
    </div>

    <!-- META -->
    <div class="section active" id="sec-meta">
      <div class="grid">
        <div>
          <label>Evidence Type<span class="req">*</span></label>
          <select id="evidenceType">
            <option value="Paper">Paper (ë…¼ë¬¸)</option>
            <option value="TrialSummary">TrialSummary (ì„ìƒ ìš”ì•½)</option>
            <option value="Review">Review (ë¦¬ë·°)</option>
            <option value="Preprint">Preprint (í”„ë¦¬í”„ë¦°íŠ¸)</option>
          </select>
        </div>
        <div>
          <label>Publication Date<span class="req">*</span></label>
          <input id="pubDate" type="date" />
        </div>

        <div style="grid-column: 1 / -1;">
          <label>Title<span class="req">*</span></label>
          <input id="title" placeholder="ì˜ˆ: First-line EGFR TKI in NSCLC with exon19del..." />
        </div>

        <div>
          <label>DOI (ì„ íƒ)</label>
          <input id="doi" placeholder="10.xxxx/xxxxx" />
        </div>
        <div>
          <label>Source URL (ì„ íƒ)</label>
          <input id="sourceUrl" placeholder="https://..." />
        </div>

        <div style="grid-column: 1 / -1;">
          <label>Authors / Organization (ì„ íƒ)</label>
          <input id="authors" placeholder="ì˜ˆ: Kim J; Lee S; ... ë˜ëŠ” Sponsor/Company" />
        </div>

        <div>
          <label>Journal / Venue (ì„ íƒ)</label>
          <input id="venue" placeholder="ì˜ˆ: NEJM / ASCO / arXiv ..." />
        </div>
        <div>
          <label>Trial ID (NCT ë“±, ì„ìƒ ìš”ì•½ì¼ ë•Œ ê¶Œì¥)</label>
          <input id="trialId" placeholder="ì˜ˆ: NCT01234567" />
        </div>
      </div>

      <div class="hint">
        âœ… Hydrate ì›ì¹™: "ê²°ë¡ "ì„ ë„£ì§€ ë§ê³ , ì¶œì²˜/ë‚ ì§œ/ë§¥ë½ì„ ë¨¼ì € í™•ë³´í•˜ì„¸ìš”.
      </div>
    </div>

    <!-- CONTENT -->
    <div class="section" id="sec-content">
      <div class="grid">
        <div style="grid-column: 1 / -1;">
          <label>Abstract / Trial Summary Text<span class="req">*</span></label>
          <textarea id="abstractText" placeholder="ë…¼ë¬¸ ì´ˆë¡ ë˜ëŠ” ì„ìƒ ìš”ì•½ í…ìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°"></textarea>
          <div class="hint">ë¶™ì—¬ë„£ì€ í…ìŠ¤íŠ¸ëŠ” EvidenceItemì˜ ì›ë¬¸(ê·¼ê±°)ë¡œ ì €ì¥ë©ë‹ˆë‹¤. (RAG ì¶”ì¶œ í›„ë³´ ìƒì„±ì—ë„ ì‚¬ìš©)</div>
        </div>

        <div style="grid-column: 1 / -1;">
          <label>Methods / Notes (ì„ íƒ)</label>
          <textarea id="methodsText" placeholder="ëª¨ë¸/í™˜ìêµ°/endpoint ì •ì˜ ë“± ì¤‘ìš”í•œ ë§¥ë½ ë©”ëª¨"></textarea>
        </div>
      </div>
    </div>

    <!-- ENTITIES -->
    <div class="section" id="sec-entities">
      <div class="grid3">
        <div>
          <label>Cancer Type<span class="req">*</span></label>
          <select id="cancerType">
            <option value="NSCLC">NSCLC</option>
          </select>
        </div>
        <div>
          <label>Gene Focus<span class="req">*</span></label>
          <select id="geneFocus">
            <option value="EGFR">EGFR</option>
            <option value="ALK">ALK</option>
          </select>
        </div>
        <div>
          <label>Alteration<span class="req">*</span></label>
          <select id="alteration">
            <option value="EGFR_ex19del">EGFR exon19 del</option>
            <option value="EGFR_L858R">EGFR L858R</option>
            <option value="ALK_fusion">ALK fusion</option>
          </select>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>Patient Subgroup Label (ìë™ ìƒì„±)</label>
          <input id="subgroupLabel" readonly />
          <div class="small">ì˜ˆ: NSCLC + EGFR exon19 del</div>
        </div>
        <div>
          <label>Line of Therapy (ì„ íƒ)</label>
          <select id="lot">
            <option value="">(ë¯¸ìƒ)</option>
            <option value="1L">1L</option>
            <option value="2L">2L</option>
            <option value="3L+">3L+</option>
          </select>
        </div>

        <div style="grid-column: 1 / -1;">
          <label>Drug / Compound Name<span class="req">*</span></label>
          <input id="drugName" placeholder="ì˜ˆ: Drug_A (EGFR inhibitor)" />
        </div>

        <div>
          <label>MoA (ì„ íƒ)</label>
          <select id="moa">
            <option value="">(ë¯¸ìƒ)</option>
            <option value="TKI">TKI</option>
            <option value="mAb">mAb (í•­ì²´)</option>
            <option value="ADC">ADC</option>
          </select>
        </div>
        <div>
          <label>Targets (ìë™: Gene Focus)</label>
          <input id="targets" readonly />
        </div>
      </div>

      <div class="hint">
        ğŸ” ë™ì˜ì–´ ì •ê·œí™”ëŠ” ì—¬ê¸°ì„œ ì‹œì‘í•©ë‹ˆë‹¤. EGFR/ALK, ë³€ì´ í‘œê¸°(ex19del vs del19)ë¥¼ "í•œ ì¸ìŠ¤í„´ìŠ¤"ë¡œ ê³ ì •í•˜ëŠ” ê²Œ hydrateì˜ í•µì‹¬ì…ë‹ˆë‹¤.
      </div>
    </div>

    <!-- RESULTS -->
    <div class="section" id="sec-results">
      <div class="grid">
        <div>
          <label>Metric<span class="req">*</span></label>
          <select id="metric">
            <option value="ORR">ORR</option>
            <option value="PFS">PFS</option>
            <option value="OS">OS</option>
            <option value="IC50">IC50</option>
          </select>
        </div>
        <div>
          <label>Value<span class="req">*</span></label>
          <input id="value" type="number" step="0.01" placeholder="ì˜ˆ: 62.0" />
        </div>
        <div>
          <label>Unit<span class="req">*</span></label>
          <select id="unit">
            <option value="%">%</option>
            <option value="months">months</option>
            <option value="nM">nM</option>
            <option value="uM">uM</option>
          </select>
        </div>

        <div style="grid-column: 1 / -1;">
          <label>Result Notes (ì„ íƒ)</label>
          <input id="resultNotes" placeholder="ì˜ˆ: median follow-up, cutoff date, cohort details..." />
        </div>
      </div>

      <div class="hint">
        âœ… SHACL ê²Œì´íŠ¸ ê´€ì : metric/value/unit + reportedIn(EvidenceItem)ì´ ì—†ìœ¼ë©´ ResultëŠ” "ë³´ë¥˜/ë°˜ë ¤" ì²˜ë¦¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
      </div>
    </div>

    <!-- GOVERNANCE -->
    <div class="section" id="sec-governance">
      <div class="grid">
        <div>
          <label>Peer Reviewed?</label>
          <select id="peerReviewed">
            <option value="unknown">unknown</option>
            <option value="true">true</option>
            <option value="false">false</option>
          </select>
        </div>
        <div>
          <label>Confidence Level</label>
          <select id="confidence">
            <option value="Medium">Medium</option>
            <option value="High">High</option>
            <option value="Low">Low</option>
          </select>
        </div>

        <div style="grid-column: 1 / -1;">
          <label>Limitations / Caveats (ì„ íƒ)</label>
          <textarea id="limitations" placeholder="ì˜ˆ: small N, single-arm, selection bias, immature OS data..."></textarea>
        </div>

        <div>
          <label>Funding / Sponsor (ì„ íƒ)</label>
          <input id="funding" placeholder="ì˜ˆ: Pharma / Public / Unknown" />
        </div>
        <div>
          <label>Conflict of Interest (ì„ íƒ)</label>
          <select id="coi">
            <option value="unknown">unknown</option>
            <option value="true">true</option>
            <option value="false">false</option>
          </select>
        </div>
      </div>

      <div class="hint">
        ğŸ§  ì—¬ê¸°ê¹Œì§€ ì €ì¥ë˜ë©´, Activate ë‹¨ê³„ì—ì„œ SWRL/ìŠ¤ì½”ì–´ë§ì´ "ê·¼ê±°ì˜ ì§ˆ"ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    </div>

    <div class="btns">
      <button class="secondary" id="btnExample">ì˜ˆì‹œ ì±„ìš°ê¸°</button>
      <button class="danger" id="btnClear">ì´ˆê¸°í™”</button>
      <button id="btnBuild">Hydrate JSON ìƒì„±</button>
    </div>

    <div class="status" id="status">
      <span class="dot" id="dot"></span>
      <span id="statusText">í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ë©´ JSONì´ ìƒì„±ë©ë‹ˆë‹¤.</span>
    </div>
  </section>

  <!-- RIGHT: PREVIEW -->
  <aside class="card">
    <h2>2) Hydrate Payload ë¯¸ë¦¬ë³´ê¸° (JSON)</h2>
    <div class="hint" style="margin-bottom:10px;">
      ì´ JSONì€ ì„œë²„ë¡œ ë³´ë‚´ì„œ<br/>
      (a) EvidenceItem ì €ì¥ â†’ (b) Result ì €ì¥ â†’ (c) SHACL ê²€ì¦ â†’ (d) Activate ë‹¨ê³„ë¡œ ë„˜ê¹€<br/>
      ê°™ì€ íŒŒì´í”„ë¼ì¸ì— ë°”ë¡œ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>
    <pre id="preview">{}</pre>
  </aside>
</main>

<script>
  const $ = (id) => document.getElementById(id);

  // Tabs
  const tabs = Array.from(document.querySelectorAll(".tab"));
  tabs.forEach(t => t.addEventListener("click", () => {
    tabs.forEach(x => x.classList.remove("active"));
    t.classList.add("active");
    const tab = t.dataset.tab;
    document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
    $("sec-" + tab).classList.add("active");
  }));

  // Auto fields
  function syncDerived() {
    const cancer = $("cancerType").value;
    const altText = $("alteration").selectedOptions[0]?.textContent || "";
    $("subgroupLabel").value = `${cancer} + ${altText}`;
    $("targets").value = $("geneFocus").value;
  }
  ["cancerType","alteration","geneFocus"].forEach(id => $(id).addEventListener("change", syncDerived));
  syncDerived();

  // Simple validation
  function validateRequired() {
    const required = [
      ["pubDate","Publication Date"],
      ["title","Title"],
      ["abstractText","Abstract/Summary Text"],
      ["geneFocus","Gene Focus"],
      ["alteration","Alteration"],
      ["drugName","Drug Name"],
      ["metric","Metric"],
      ["value","Value"],
      ["unit","Unit"],
    ];

    const missing = [];
    for (const [id, name] of required) {
      const el = $(id);
      const v = (el.value || "").trim();
      if (!v) missing.push(name);
    }
    return missing;
  }

  function setStatus(ok, msg){
    const dot = $("dot");
    dot.classList.remove("ok","bad");
    dot.classList.add(ok ? "ok" : "bad");
    $("statusText").textContent = msg;
  }

  function buildPayload(){
    const missing = validateRequired();
    if (missing.length) {
      setStatus(false, "í•„ìˆ˜ ëˆ„ë½: " + missing.join(", "));
      return null;
    }

    const evidenceType = $("evidenceType").value;
    const payload = {
      hydrate_version: "1.0",
      scope: { cancerType: "NSCLC", focus: $("geneFocus").value, axis: "Paper+TrialSummary" },

      evidenceItem: {
        type: evidenceType,                 // Paper | TrialSummary | Review | Preprint
        title: $("title").value.trim(),
        publicationDate: $("pubDate").value,
        doi: $("doi").value.trim() || null,
        sourceUrl: $("sourceUrl").value.trim() || null,
        authorsOrOrg: $("authors").value.trim() || null,
        venue: $("venue").value.trim() || null,
        trial: $("trialId").value.trim() ? { trialId: $("trialId").value.trim() } : null,

        rawText: {
          abstractOrSummary: $("abstractText").value.trim(),
          methodsOrNotes: $("methodsText").value.trim() || null
        },

        governance: {
          peerReviewed: $("peerReviewed").value,   // true/false/unknown
          confidence: $("confidence").value,       // High/Medium/Low
          limitations: $("limitations").value.trim() || null,
          funding: $("funding").value.trim() || null,
          conflictOfInterest: $("coi").value       // true/false/unknown
        }
      },

      entities: {
        cancerType: $("cancerType").value,
        gene: $("geneFocus").value,
        alteration: $("alteration").value,
        subgroupLabel: $("subgroupLabel").value,
        lineOfTherapy: $("lot").value || null,
        compound: {
          name: $("drugName").value.trim(),
          moa: $("moa").value || null,
          targets: [$("geneFocus").value]
        }
      },

      observation: {
        metric: $("metric").value,          // ORR/PFS/OS/IC50
        value: Number($("value").value),
        unit: $("unit").value,
        note: $("resultNotes").value.trim() || null
      },

      // Hydrate ë‹¨ê³„ì—ì„œëŠ” "ì¶”ì²œ/íŒë‹¨" ê¸ˆì§€: proposalì€ ë¹„ì›Œë‘ê±°ë‚˜ Draftë¡œë§Œ ìƒì„±
      proposal: {
        status: "Draft",
        text: null
      }
    };

    setStatus(true, "OK: Hydrate JSON ìƒì„± ì™„ë£Œ (íŒë‹¨/ì¶”ì²œ ì—†ì´ ê·¼ê±°+ë§¥ë½ ë³´ì¡´)");
    return payload;
  }

  // Buttons
  $("btnBuild").addEventListener("click", () => {
    const payload = buildPayload();
    if (payload) $("preview").textContent = JSON.stringify(payload, null, 2);
  });

  $("btnClear").addEventListener("click", () => {
    document.querySelectorAll("input, textarea").forEach(el => {
      if (el.type !== "date" && el.id !== "subgroupLabel" && el.id !== "targets") el.value = "";
      if (el.type === "date") el.value = "";
    });
    $("evidenceType").value = "Paper";
    $("cancerType").value = "NSCLC";
    $("geneFocus").value = "EGFR";
    $("alteration").value = "EGFR_ex19del";
    $("metric").value = "ORR";
    $("unit").value = "%";
    $("peerReviewed").value = "unknown";
    $("confidence").value = "Medium";
    $("coi").value = "unknown";
    $("lot").value = "";
    $("moa").value = "";
    syncDerived();
    $("preview").textContent = "{}";
    const dot = $("dot"); dot.classList.remove("ok","bad");
    $("statusText").textContent = "ì´ˆê¸°í™” ì™„ë£Œ. í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ë©´ JSONì´ ìƒì„±ë©ë‹ˆë‹¤.";
  });

  $("btnExample").addEventListener("click", () => {
    $("evidenceType").value = "TrialSummary";
    $("pubDate").value = "2026-01-08";
    $("title").value = "Trial summary: EGFR inhibitor in 1L NSCLC (exon19del cohort)";
    $("trialId").value = "NCT01234567";
    $("sourceUrl").value = "https://example.org/trial-summary";
    $("authors").value = "Sponsor: Example Pharma";
    $("venue").value = "ASCO (summary)";
    $("abstractText").value =
`Objective: Evaluate 1L EGFR inhibitor in NSCLC with EGFR exon19 del.
Endpoints: ORR, PFS.
Results: ORR 62%, median PFS 14.2 months (data cutoff 2025-12-31).
Safety: manageable. Limitations: single-arm, small N.`;
    $("methodsText").value = "Cohort: EGFR exon19del, treatment-naÃ¯ve. Single-arm.";
    $("geneFocus").value = "EGFR";
    $("alteration").value = "EGFR_ex19del";
    $("lot").value = "1L";
    $("drugName").value = "Drug_A";
    $("moa").value = "TKI";
    $("metric").value = "ORR";
    $("value").value = "62";
    $("unit").value = "%";
    $("resultNotes").value = "cutoff: 2025-12-31; single-arm; small N";
    $("peerReviewed").value = "unknown";
    $("confidence").value = "Medium";
    $("limitations").value = "Single-arm; small sample size; immature OS.";
    $("funding").value = "Pharma";
    $("coi").value = "unknown";
    syncDerived();

    const payload = buildPayload();
    if (payload) $("preview").textContent = JSON.stringify(payload, null, 2);
  });

  // Live status update on key fields
  ["pubDate","title","abstractText","drugName","value"].forEach(id => {
    $(id).addEventListener("input", () => {
      const missing = validateRequired();
      if (missing.length) {
        setStatus(false, "í•„ìˆ˜ ëˆ„ë½: " + missing.join(", "));
      } else {
        setStatus(true, "í•„ìˆ˜ ì¶©ì¡±: 'Hydrate JSON ìƒì„±'ì„ ëˆŒëŸ¬ ì €ì¥í•˜ì„¸ìš”.");
      }
    });
  });
</script>
</body>
</html>
